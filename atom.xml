<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>æ€åº¦å†³å®šé«˜åº¦,ç»†èŠ‚å†³å®šæˆè´¥</title>
  
  <subtitle>ç–¯ç‹‚çš„ç å†œ</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://www.fengqinglei.top/"/>
  <updated>2019-10-03T08:30:56.061Z</updated>
  <id>https://www.fengqinglei.top/</id>
  
  <author>
    <name>FQL</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>ç©è½¬Solræºç ä¹‹(ä¸‰)Solræºç Deploy</title>
    <link href="https://www.fengqinglei.top/2019/10/03/solr-source-code-deploy/"/>
    <id>https://www.fengqinglei.top/2019/10/03/solr-source-code-deploy/</id>
    <published>2019-10-02T23:57:04.000Z</published>
    <updated>2019-10-03T08:30:56.061Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ç©è½¬Solræºç ä¹‹â€”Solræºç Deploy"><a href="#ç©è½¬Solræºç ä¹‹â€”Solræºç Deploy" class="headerlink" title="ç©è½¬Solræºç ä¹‹â€”Solræºç Deploy"></a><font color="#0077bb">ç©è½¬Solræºç ä¹‹â€”Solræºç Deploy</font></h1><p>è¿™ç¯‡æ–‡ç« æ˜¯<strong>ç©è½¬Solræºç </strong>ç³»åˆ—çš„ç¬¬ä¸‰ç¯‡ï¼Œç´§æ¥ç€ä¸Šä¸€ç¯‡çš„<a href="https://www.fengqinglei.top/2019/10/01/solr-source-code-debug/">æºç Deug</a>ã€‚å¦‚æœä½ å·²ç»ä¿®æ”¹å¥½äº†æºç ï¼Œå¹¶ä¸”è°ƒè¯•okï¼Œæƒ³è¦å°†æºç æ‰“åŒ…ååˆ†å‘ç»™åŒæ—¶æˆ–è€…å…¶ä»–é¡¹ç›®å¼•ç”¨ï¼Œé‚£ä¹ˆè¿™è¾¹æ–‡ç« ä¸€å®šèƒ½å¤Ÿå¸®åŠ©ä½ ã€‚<br><a id="more"></a></p><h2 id="ä¸åˆ°ä¸‡ä¸å¾—å·±ï¼Œåˆ«ç›´æ¥æ”¹æºä»£ç "><a href="#ä¸åˆ°ä¸‡ä¸å¾—å·±ï¼Œåˆ«ç›´æ¥æ”¹æºä»£ç " class="headerlink" title="ä¸åˆ°ä¸‡ä¸å¾—å·±ï¼Œåˆ«ç›´æ¥æ”¹æºä»£ç "></a><font color="#0077bb">ä¸åˆ°ä¸‡ä¸å¾—å·±ï¼Œåˆ«ç›´æ¥æ”¹æºä»£ç </font></h2><p>ä¸€èˆ¬è€Œè¨€ï¼Œå¦‚æœå°†Solr/Elasticsearchåº”ç”¨äºä¼ä¸šçº§å¼€å‘ï¼ŒSolråŸç”Ÿçš„åŠŸèƒ½æˆ–å¤šæˆ–å°‘éƒ½ä¸èƒ½100%çš„æ»¡è¶³ä¼ä¸šçš„ä¸šåŠ¡éœ€æ±‚(å®¢æˆ·çš„éœ€æ±‚éƒ½æ˜¯æ¯”è¾ƒå˜æ€çš„),è¿™ä¹Ÿä½¿å¾—æˆ‘ä»¬æœ‰çš„æ—¶å€™ä¸å¾—ä¸é€šè¿‡ä¿®æ”¹æºä»£ç çš„æ–¹å¼æ¥è¾¾åˆ°æˆ‘ä»¬çš„ç›®çš„ï¼Œæ”¹æºç éš¾ï¼Œç®¡ç†æºä»£ç æ›´éš¾ï¼Œæ¯•ç«Ÿå‡ ä¸‡ç”šè‡³å‡ åä¸‡çš„è¡Œçš„Solræºç ï¼Œä½ åªåŠ¨äº†å…¶ä¸­ä¸€ä¸ªç±»ä¸­çš„æŸä¸€ä¸ªæ–¹æ³•ï¼Œç»“æœä¸ºäº†ç®¡ç†ï¼Œä½ éœ€è¦ä¸“é—¨æä¸ªgitä»“åº“ï¼Œç„¶åè¿˜è¦å®šä¹‰å¥½ç‰ˆæœ¬å·ï¼Œæ”¾åˆ°nexusä»“åº“ç»™å…¶ä»–ç»„å‘˜æˆ–è€…å…¶ä»–é¡¹ç›®å¼•ç”¨ï¼Œæ”¹ä»£ç å¯èƒ½èŠ±äº†ä½ ä¸€ä¸ªå°æ—¶ï¼Œä½†æ˜¯ç®¡ç†è¿™äº›ä»£ç å¯èƒ½éœ€è¦è®©ä½ å¿™æ´»ä¸€ä¸ªä¸Šåˆã€‚æ‰€ä»¥ä¸åˆ°ä¸‡ä¸å¾—å·²å°½é‡é€šè¿‡ç»§æ‰¿/å®ç°ç­‰æ–¹å¼æ¥ä¿®æ”¹æºç ï¼Œè¿™æ ·åœ¨ç‰ˆæœ¬å‡çº§çš„æ—¶å€™ï¼Œå·¥ä½œé‡ä¼šå°å¾ˆå¤šã€‚å¦åˆ™çš„è¯ï¼Œå¹²è¿‡çš„äººéƒ½çŸ¥é“å¾ˆç—›è‹¦ï¼Œç‰¹åˆ«æ˜¯ä¸Šä¸€ä¸ªæ”¹äº†æºç çš„äººå·²ç»ç¦»èŒäº†ã€‚<br><img src="https://s2.ax1x.com/2019/10/03/uwD7dI.jpg" alt="uwD7dI.jpg"></p><h2 id="ä»æºç åˆ°Nexus"><a href="#ä»æºç åˆ°Nexus" class="headerlink" title="ä»æºç åˆ°Nexus"></a><font color="#0077bb">ä»æºç åˆ°Nexus</font></h2><p>ç¬”è€…æ‰€åœ¨çš„å…¬å¸Javaå¼€å‘ä½¿ç”¨çš„æ„å»ºå’Œä¾èµ–ç®¡ç†å·¥å…·æ˜¯Maven,ä»“åº“çš„è¯ä½¿ç”¨çš„æ˜¯è‡ªå»ºçš„nexus,æˆ‘ç›¸ä¿¡è¿™ä¹Ÿæ˜¯å¤§éƒ¨åˆ†å…¬å¸çš„æ¨¡å¼ï¼Œå½“ç„¶ä¹Ÿæœ‰ç”¨Gradleï¼Œè¿™é‡Œä¸æ¯”è¾ƒä¸¤ä¸ªå·¥å…·çš„å¥½åï¼Œèƒ½å®Œæˆå¼€å‘ï¼Œé«˜æ•ˆç‡å¹¶ä¸”ä½¿ç”¨çš„é¡ºæ‰‹çš„éƒ½æ˜¯å¥½å·¥å…·ã€‚ç¬”è€…è¿™é‡Œä»¥maven+ nexusä¸ºä¾‹ã€‚</p><h3 id="å®‰è£…Nexus"><a href="#å®‰è£…Nexus" class="headerlink" title="å®‰è£…Nexus"></a><font color="#0077bb">å®‰è£…Nexus</font></h3><p>å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œnexusä»“åº“è¿™ç§å·¥ä½œéƒ½æ˜¯äº¤ç»™è¿ç»´å»æçš„ï¼Œä¸€èˆ¬å¼€å‘åªéœ€è¦çŸ¥é“å¦‚ä½•ä½¿ç”¨å°±è¡Œï¼Œå¦‚æœä½ å¯¹å®‰è£…nexusæ²¡æœ‰ä»»ä½•å…´è¶£ï¼Œé‚£ä¹ˆè¿™éƒ¨åˆ†å¯ä»¥é€‰æ‹©è·³è¿‡ã€‚<br>ä¸ºäº†æ–¹ä¾¿æ¼”ç¤ºï¼Œè¿™é‡Œç¬”è€…ä½¿ç”¨äº†dockerè¿›è¡Œå®‰è£…å’Œéƒ¨ç½²nexusï¼Œæµç¨‹æ¯”è¾ƒç®€å•ï¼Œå‡ è¡Œå‘½ä»¤å°±è¡Œäº†,è¿™é‡Œä»¥<a href="https://hub.docker.com/r/sonatype/nexus/" target="_blank" rel="noopener">nexus2</a>ä¸ºä¾‹å­.<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker pull sonatype/nexus</span><br><span class="line">docker run -d -p 8081:8081 --name nexus-oss sonatype/nexus</span><br></pre></td></tr></table></figure></p><p>æ‰“å¼€æµè§ˆå™¨è¾“å…¥<strong><a href="http://127.0.0.1:8081/nexus" target="_blank" rel="noopener">http://127.0.0.1:8081/nexus</a></strong>å°±å¯ä»¥çœ‹åˆ°nexuysç•Œé¢å•¦ï¼Œé»˜è®¤çš„ç™»é™†ç”¨æˆ·åå’Œå¯†ç ä¸ºadmin,admin123<br><img src="https://s2.ax1x.com/2019/10/03/uwRhqS.png" alt="Nexus2"></p><h3 id="ä½¿ç”¨antç”Ÿæˆmaven-artifactså¹¶ä¸Šä¼ "><a href="#ä½¿ç”¨antç”Ÿæˆmaven-artifactså¹¶ä¸Šä¼ " class="headerlink" title="ä½¿ç”¨antç”Ÿæˆmaven artifactså¹¶ä¸Šä¼ "></a><font color="#0077bb">ä½¿ç”¨antç”Ÿæˆmaven artifactså¹¶ä¸Šä¼ </font></h3><p>Solrä¸­çš„æºç å·²ç»æ”¯æŒç”Ÿæˆmaven artifacetså¹¶ä¸”ä¸Šä¼ åˆ°è‡ªå®šä¹‰çš„ä»“åº“ä¸­ï¼Œç®€å•çš„å‘½ä»¤ä¸º<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ant -Dversion=my-special-version -Dm2.repository.id=my-repo-id \</span><br><span class="line">          -Dm2.repository.url=https://example.org/my/repo \</span><br><span class="line">          generate-maven-artifacts</span><br></pre></td></tr></table></figure></p><p>è¿™é‡Œè§£é‡Šä¸‹å‚æ•°çš„å«ä¹‰</p><div class="table-container"><table><thead><tr><th>å˜é‡å</th><th>è§£é‡Š</th></tr></thead><tbody><tr><td>my-special-version</td><td>æŒ‡å®šç‰ˆæœ¬å·ï¼Œè¿™ä¸ªå¤§å®¶æ ¹æ®éœ€è¦å¯ä»¥è‡ªå®šä¹‰ï¼Œä½†æ˜¯è¿˜æ˜¯éœ€è¦ä¸€å®šçš„å‘½åè§„èŒƒï¼ˆä¸‹é¢ä¼šè®²åˆ°ï¼‰</td></tr><tr><td>my-repo-id</td><td>è¡¨ç¤ºnexusä»“åº“çš„idï¼Œåç§°ä¸€èˆ¬éƒ½æ˜¯è‡ªå®šä¹‰çš„</td></tr><tr><td>m2.repository.url</td><td>è¡¨ç¤ºnexuysä»“åº“çš„åœ°å€ï¼Œç¬”è€…è¿™é‡Œçš„åœ°å€å°±æ˜¯<strong><a href="http://127.0.0.1:8081/nexus/content/repositories/releases/" target="_blank" rel="noopener">http://127.0.0.1:8081/nexus/content/repositories/releases/</a></strong></td></tr></tbody></table></div><p>å…·ä½“çš„å¯ä»¥å‚è€ƒæ–‡æ¡£<a href="https://github.com/apache/lucene-solr/blob/master/dev-tools/maven/README.maven" target="_blank" rel="noopener">Lucene/Solr Maven build instructions</a>ã€‚<br>åˆ°è¿™é‡Œå¤§å®¶åŸºæœ¬ä¸Šå·²ç»çŸ¥é“å¦‚æ˜¯å°†ä¿®æ”¹è¿‡åçš„solræºä»£ç æ‰“åŒ…å¹¶ä¸”ä¸Šä¼ mavenäº†å§ï¼ŒåºŸè¯ä¸å¤šè¯´ï¼Œç›´æ¥ä¸Šå‘½ä»¤<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[fql@localhost solr-7.7.2]$ ant -Dversion=TEST -Dm2.repository.id=nexus -Dm2.repository.url=http://127.0.0.1:8081/nexus/content/repositories/releases/ generate-maven-artifacts</span><br><span class="line">Buildfile: /home/fql/IdeaProjects/solr-7.7.2/build.xml</span><br><span class="line"></span><br><span class="line">BUILD FAILED</span><br><span class="line">/home/fql/IdeaProjects/solr-7.7.2/build.xml:21: The following error occurred <span class="keyword">while</span> executing this line:</span><br><span class="line">/home/fql/IdeaProjects/solr-7.7.2/lucene/common-build.xml:63: If you pass -Dversion=... to <span class="built_in">set</span> a release version, it must match <span class="string">"7.7.2"</span>, optionally followed by a suffix (e.g., <span class="string">"-SNAPSHOT"</span>).</span><br><span class="line"></span><br><span class="line">Total time: 0 seconds</span><br></pre></td></tr></table></figure></p><p>æ“¦ï¼Œ&lt;ä¸€é¡¿æ“ä½œçŒ›å¦‚è™ï¼Œå®šç›ä¸€çœ‹åŸåœ°æµ&gt;,åŸæ¥versionçš„åç§°æµ·å¿…é¡»åŒ¹é…<strong>7.7.2</strong>,å¥½å§ï¼Œå†æ¥<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[fql@localhost solr-7.7.2]$ ant -Dversion=7.7.2-TEST -Dm2.repository.id=nexus -Dm2.repository.url=http://127.0.0.1:8081/nexus/content/repositories/releases/ generate-maven-artifacts</span><br><span class="line">Buildfile: /home/fql/IdeaProjects/solr-7.7.2/build.xml</span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line">[artifact:deploy] Error deploying artifact <span class="string">'org.apache.lucene:lucene-solr-grandparent:pom'</span>: Error deploying artifact: Failed to transfer file: http://127.0.0.1:8081/nexus/content/repositories/releases/org/apache/lucene/lucene-solr-grandparent/7.7.2-TEST/lucene-solr-grandparent-7.7.2-TEST.pom. Return code is: 401</span><br><span class="line"></span><br><span class="line">BUILD FAILED</span><br><span class="line">/home/fql/IdeaProjects/solr-7.7.2/build.xml:209: The following error occurred <span class="keyword">while</span> executing this line:</span><br><span class="line">/home/fql/IdeaProjects/solr-7.7.2/lucene/build.xml:404: The following error occurred <span class="keyword">while</span> executing this line:</span><br><span class="line">/home/fql/IdeaProjects/solr-7.7.2/lucene/common-build.xml:656: Error deploying artifact <span class="string">'org.apache.lucene:lucene-solr-grandparent:pom'</span>: Error deploying artifact: Failed to transfer file: http://127.0.0.1:8081/nexus/content/repositories/releases/org/apache/lucene/lucene-solr-grandparent/7.7.2-TEST/lucene-solr-grandparent-7.7.2-TEST.pom. Return code is: 401</span><br><span class="line">Total time: 8 minutes 53 seconds</span><br></pre></td></tr></table></figure></p><p><strong>Return code is: 401</strong>,è²Œä¼¼æƒé™ä¸å¯¹ï¼Œç¡®å®å‘½ä»¤ä¸­æ²¡æœ‰ä¼ ä»»ä½•ç”¨æˆ·åå’Œå¯†ç çš„ä¿¡æ¯ï¼Œè¿™é‡Œé€šè¿‡<strong>generate-maven-artifacts</strong>å®šä½åˆ°solr-7.7.2/lucene/common-build.xml æ–‡ä»¶ä¸­çš„<strong>m2-deploy</strong>(ç¬¬646è¡Œ)ï¼Œå¹¶ä¸”åœ¨å…¶ä¸‹é¢çš„<strong>remoteRepository</strong>æ·»åŠ <br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">authentication</span> <span class="attr">username</span>=<span class="string">"admin"</span> <span class="attr">password</span>=<span class="string">"admin123"</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- admin å’Œadmin123 å°±æ˜¯nexusçš„é»˜è®¤ç”¨æˆ·åå’Œå¯†ç --&gt;</span></span><br></pre></td></tr></table></figure></p><p>é‡æ–°æ‰§è¡Œå‘½ä»¤æˆ‘ä»¬å°±å¯ä»¥çœ‹åˆ°é¡¹ç›®å·²ç»æˆåŠŸçš„ä¸Šä¼ åˆ°äº†æœ¬åœ°çš„nexus(çœ‹èµ·æ¥ä¸€è¡Œä»£ç æå®šçš„é—®é¢˜ï¼Œç¡®å®è®©ä½ ç¢ç£¨äº†ä¸€ä¸ªä¸Šåˆ)<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[fql@localhost solr-7.7.2]$ ant -Dversion=7.7.2-TEST -Dm2.repository.id=nexus -Dm2.repository.url=http://192.168.34.128:8081/nexus/content/repositories/releases/ generate-maven-artifacts</span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line">[artifact:deploy] [INFO] Uploading repository metadata <span class="keyword">for</span>: <span class="string">'artifact org.apache.solr:solr-velocity'</span></span><br><span class="line">[artifact:deploy] Uploading: org/apache/solr/solr-velocity/7.7.2-TEST/solr-velocity-7.7.2-TEST-sources.jar to repository nexus at http://192.168.34.128:8081/nexus/content/repositories/releases/</span><br><span class="line">[artifact:deploy] Transferring 31K from nexus</span><br><span class="line">[artifact:deploy] Uploaded 31K</span><br><span class="line">[artifact:deploy] Uploading: org/apache/solr/solr-velocity/7.7.2-TEST/solr-velocity-7.7.2-TEST-javadoc.jar to repository nexus at http://192.168.34.128:8081/nexus/content/repositories/releases/</span><br><span class="line">[artifact:deploy] Transferring 64K from nexus</span><br><span class="line">[artifact:deploy] Uploaded 64K</span><br><span class="line">[artifact:install] [INFO] Installing /home/fql/IdeaProjects/solr-7.7.2/solr/build/solr.tgz.unpacked/solr-7.7.2-TEST/dist/solr-velocity-7.7.2-TEST.jar to /home/fql/.m2/repository/org/apache/solr/solr-velocity/7.7.2-TEST/solr-velocity-7.7.2-TEST.jar</span><br><span class="line">[artifact:install] [INFO] Installing /home/fql/IdeaProjects/solr-7.7.2/solr/build/contrib/solr-velocity/solr-velocity-7.7.2-TEST-src.jar to /home/fql/.m2/repository/org/apache/solr/solr-velocity/7.7.2-TEST/solr-velocity-7.7.2-TEST-sources.jar</span><br><span class="line">[artifact:install] [INFO] Installing /home/fql/IdeaProjects/solr-7.7.2/solr/build/contrib/solr-velocity/solr-velocity-7.7.2-TEST-javadoc.jar to /home/fql/.m2/repository/org/apache/solr/solr-velocity/7.7.2-TEST/solr-velocity-7.7.2-TEST-javadoc.jar</span><br><span class="line">[artifact:install] [INFO] Installing /home/fql/IdeaProjects/solr-7.7.2/solr/build/contrib/solr-velocity/solr-velocity-7.7.2-TEST-src.jar to /home/fql/.m2/repository/org/apache/solr/solr-velocity/7.7.2-TEST/solr-velocity-7.7.2-TEST-sources.jar</span><br><span class="line">[artifact:install] [INFO] Installing /home/fql/IdeaProjects/solr-7.7.2/solr/build/contrib/solr-velocity/solr-velocity-7.7.2-TEST-javadoc.jar to /home/fql/.m2/repository/org/apache/solr/solr-velocity/7.7.2-TEST/solr-velocity-7.7.2-TEST-javadoc.jar</span><br><span class="line">BUILD SUCCESSFUL</span><br><span class="line">Total time: 6 minutes 37 seconds</span><br></pre></td></tr></table></figure></p><p>æ‰“å¼€æµè§ˆå™¨<strong><a href="http://127.0.0.1:8081/nexus/content/repositories/releases/org/apache/lucene/" target="_blank" rel="noopener">http://127.0.0.1:8081/nexus/content/repositories/releases/org/apache/lucene/</a></strong> æˆ‘ä»¬å°±å¯ä»¥çœ‹è§solrç›¸å…³çš„jaråŒ…pomç­‰ä¿¡æ¯å·²ç»ä¸Šä¼ æˆåŠŸ<br><img src="https://s2.ax1x.com/2019/10/03/uwLkQg.png" alt="nexus_solr"></p><h3 id="çˆ¬å‘å°æŠ€å·§"><a href="#çˆ¬å‘å°æŠ€å·§" class="headerlink" title="çˆ¬å‘å°æŠ€å·§"></a><font color="#0077bb">çˆ¬å‘å°æŠ€å·§</font></h3><p>çœ‹ä¼¼ç®€å•çš„å·¥ä½œï¼Œå®é™…æ“ä½œèµ·æ¥æ•´çš„è€—è´¹äº†å¾ˆé•¿çš„æ—¶é—´ï¼Œå…³é”®æ˜¯å…³äº<strong>authentication</strong>çš„é‚£éƒ¨åˆ†googleäº†å¥½ä¹…å‘ç°æ²¡ä¸€ä¸ªäººæã€‚ä¸ºäº†é˜²æ­¢å¤§å®¶å†æ¬¡çˆ¬å‘ï¼Œè¿™é‡Œç»™å¤§å®¶åˆ†äº«ä¸¤ä¸ªçŸ¥è¯†ç‚¹/å°æŠ€å·§</p><blockquote><ul><li>è§£å†³ant idea ä¸‹è½½æ¯”è¾ƒæ…¢çš„é—®é¢˜<br>å¤§å®¶åœ¨å¯¼å…¥Solræºç é¡¹ç›®çš„æ—¶å€™å¯èƒ½å·²ç»å‘ç°äº†ï¼Œ(<strong>ant idea</strong>)æ•´ä¸ªè¿‡ç¨‹éå¸¸çš„æ…¢,ç¬”è€…æ›´æ˜¯ç­‰äº†ä¸€ä¸ªä¸‹åˆæ‰æ„å»ºå¥½ï¼Œæ­£å¸¸çš„å¼€å‘ä¸­æˆ‘ä»¬ä¸å¯èƒ½ç­‰è¿™ä¹ˆä¹…ï¼Œè¿™é‡Œå¯èƒ½æœ‰äººè¯´ä½¿ç”¨mavené»˜è®¤çš„ä»“åº“åœ¨æµ·å¤–å¯¼è‡´çš„ï¼Œæˆ‘ä»¬ä½¿ç”¨aliyunçš„ä»“åº“å°±å¯è¡Œäº†(ç¬”è€…å°è¯•äº†ï¼Œä¸è¡Œï¼Œä¸çŸ¥é“ä¸ºä»€ä¹ˆé˜¿é‡Œäº‘ä¸‹è½½çš„æ—¶å€™æ²¡æœ‰httpçŠ¶æ€ç ï¼Œå¯¼è‡´ivyè®¤ä¸ºä»“åº“ä¸å¯ç”¨)ï¼Œè¿™é‡Œç¬”è€…ä½¿ç”¨äº†è…¾è®¯äº‘çš„ä»“åº“(<a href="http://mirrors.cloud.tencent.com/nexus/repository/maven-public/),ä¼é¹…è²Œä¼¼æ¯”é˜¿é‡Œå®ˆè§„èŒƒã€‚ã€‚,å…·ä½“çš„æ”¹åŠ¨ç‚¹ä¸ºï¼Œä¿®æ”¹**solr-7.7.2/lucene/default-nested-ivy-settings.xml**é…ç½®æ–‡ä»¶ï¼Œæ·»åŠ è‡ªå®šä¹‰resolver" target="_blank" rel="noopener">http://mirrors.cloud.tencent.com/nexus/repository/maven-public/),ä¼é¹…è²Œä¼¼æ¯”é˜¿é‡Œå®ˆè§„èŒƒã€‚ã€‚,å…·ä½“çš„æ”¹åŠ¨ç‚¹ä¸ºï¼Œä¿®æ”¹**solr-7.7.2/lucene/default-nested-ivy-settings.xml**é…ç½®æ–‡ä»¶ï¼Œæ·»åŠ è‡ªå®šä¹‰resolver</a> (+è¡¨ç¤ºåœ¨æºæ–‡ä»¶ä¸­å¢åŠ ä¸€è¡Œï¼Œ-è¡¨ç¤ºåˆ é™¤æºæ–‡ä»¶ä¸­çš„æŸä¸€è¡Œ)<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resolvers</span>&gt;</span></span><br><span class="line"> +   <span class="tag">&lt;<span class="name">ibiblio</span> <span class="attr">name</span>=<span class="string">"tecent"</span> <span class="attr">root</span>=<span class="string">"http://mirrors.cloud.tencent.com/nexus/repository/maven-public/"</span>  <span class="attr">m2compatible</span>=<span class="string">"true"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ibiblio</span> <span class="attr">name</span>=<span class="string">"sonatype-releases"</span> <span class="attr">root</span>=<span class="string">"https://oss.sonatype.org/content/repositories/releases"</span> <span class="attr">m2compatible</span>=<span class="string">"true"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ibiblio</span> <span class="attr">name</span>=<span class="string">"maven.restlet.com"</span> <span class="attr">root</span>=<span class="string">"https://maven.restlet.com"</span> <span class="attr">m2compatible</span>=<span class="string">"true"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ibiblio</span> <span class="attr">name</span>=<span class="string">"releases.cloudera.com"</span> <span class="attr">root</span>=<span class="string">"https://repository.cloudera.com/cloudera/libs-release-local"</span> <span class="attr">m2compatible</span>=<span class="string">"true"</span> /&gt;</span></span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line">-    <span class="tag">&lt;<span class="name">resolver</span> <span class="attr">ref</span>=<span class="string">"main"</span>/&gt;</span></span><br><span class="line">+    <span class="tag">&lt;<span class="name">resolver</span> <span class="attr">ref</span>=<span class="string">"tecent"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resolver</span> <span class="attr">ref</span>=<span class="string">"maven.restlet.com"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resolver</span> <span class="attr">ref</span>=<span class="string">"sonatype-releases"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resolver</span> <span class="attr">ref</span>=<span class="string">"releases.cloudera.com"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">chain</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">resolvers</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul></blockquote><p>å¤‡ä»½å¹¶åˆ é™¤~/.ivy2/cache,å¦åˆ™ä¼šä½¿ç”¨ç¼“å­˜ï¼Œé‡æ–°æ‰§è¡Œå‘½ä»¤(<strong>ant idea</strong>)ä¹‹åä½ ä¼šå‘ç°è¿˜æ˜¯ä¼šå¡åœ¨resolve,ä½†æ˜¯ä¸‹è½½jaråŒ…çš„é€Ÿåº¦å˜å¿«äº†ï¼Œç¬”è€…googleäº†åŠå¤©å‘ç°æ²¡æœ‰ç­”æ¡ˆï¼ŒçŒœæƒ³å¯èƒ½æ˜¯å¤šä¸ªresolve å¯¼è‡´çš„ï¼Œå°è¯•æ³¨é‡Šå…¶ä»–çš„æœºå™¨resolver,å…·ä½“çš„æ”¹åŠ¨ä¸º<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">-    <span class="tag">&lt;<span class="name">resolver</span> <span class="attr">ref</span>=<span class="string">"main"</span>/&gt;</span></span><br><span class="line">+    <span class="tag">&lt;<span class="name">resolver</span> <span class="attr">ref</span>=<span class="string">"tecent"</span>/&gt;</span></span><br><span class="line">+   <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">    &lt;resolver ref="maven.restlet.com" /&gt;</span></span><br><span class="line"><span class="comment">    &lt;resolver ref="sonatype-releases" /&gt;</span></span><br><span class="line"><span class="comment">    &lt;resolver ref="releases.cloudera.com"/&gt;</span></span><br><span class="line"><span class="comment">+   --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">chain</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">resolvers</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p>åˆ é™¤~/.ivy2/cache ,é‡æ–°æ‰§è¡Œå‘½ä»¤(<strong>ant idea</strong>)ä¹‹åï¼Œæœç„¶é€Ÿåº¦å¿«äº†å¾ˆå¤š,è‡³æ­¤ï¼Œæ…¢çš„é—®é¢˜æˆ‘ä»¬ä¹Ÿè§£å†³äº†ï¼Œç®€ç›´ğŸ’¯ã€‚(ä½¿ç”¨é»˜è®¤çš„è¯æ‰§è¡Œéœ€è¦40åˆ†é’Ÿï¼Œæ”¹è¿›ä¹‹å20åˆ†é’Ÿå³å¯)</p><blockquote><ul><li>å¦‚ä½•å®šä½åˆ°<strong>authentication</strong><br>è™½ç„¶è§£å†³<strong>401</strong>è¿™ä¸ªé—®é¢˜åªéœ€è¦ä¸€è¡Œä»£ç å°±è¡Œäº†ï¼Œä½†æ˜¯æ‰¾åˆ°è¿™è¡Œä»£ç ç¬”è€…ç¡®å®èŠ±äº†å¾ˆé•¿çš„æ—¶é—´ï¼Œæœ€ç»ˆæˆ‘æ‰¾åˆ°äº†å…³äº<a href="https://maven.apache.org/ant-tasks/reference.html#remoteRepository" target="_blank" rel="noopener">remoteRepository</a>çš„å®šä¹‰æ‰æ‰¾åˆ°<strong>authentication</strong>(ä¸€çœ‹åå­—å°±çŸ¥é“è¿™è´§æ˜¯ç”¨æ¥ä¼ ç”¨æˆ·åå’Œå¯†ç çš„),æœ€ç»ˆåœ¨æ–‡æ¡£ä¸­å®šä½äº†å…¶é…ç½®åœ¨(<a href="http://maven.apache.org/ref/3.6.2/maven-settings/settings.html#class_server)ï¼Œæœ€ç»ˆç»è¿‡ä¸€ç•ªå°è¯•æ‰æˆåŠŸï¼Œå¤ªå‘äº†ã€‚" target="_blank" rel="noopener">http://maven.apache.org/ref/3.6.2/maven-settings/settings.html#class_server)ï¼Œæœ€ç»ˆç»è¿‡ä¸€ç•ªå°è¯•æ‰æˆåŠŸï¼Œå¤ªå‘äº†ã€‚</a><br>å½“ç„¶è¿˜æœ‰ä¸€ç§æ–¹æ³•ï¼Œå°±æ˜¯ä¸‹è½½antçš„æºç çœ‹åœ¨æºç ä¸­è¿™ä¸ªcase åˆ°åº•æ˜¯å¦‚ä½•æ‰§è¡Œäº†<strong>åº”è¯¥</strong>ä¹Ÿèƒ½æ‰¾åˆ°è¿™ä¸ªè§£æ³•</li></ul></blockquote><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a><font color="#0077bb">æ€»ç»“</font></h2><p>åˆ°è¿™é‡Œç©è½¬Solræºç ç³»åˆ—å°±å®Œå…¨ç»“æŸäº†ï¼Œè™½ç„¶å†…å®¹ä¸å¤šï¼Œä½†æ˜¯å…¨æ˜¯å¹²è´§(æ¯•ç«Ÿæ˜¯ç¬”è€…ä¸€æ­¥ä¸€ä¸ªå‘çˆ¬è¿‡æ¥çš„)ã€‚å¦‚æœä½ å¯¹è¯¥ç³»åˆ—æœ‰è¡¥å……æˆ–è€…æ›´å¥½çš„æ„è§å¯ä»¥è”ç³»Email:fengqingleiyue@163.com<br>æœ€åæ¥ç¢—é¸¡æ±¤:&lt;<strong>ä½ èƒ½èµ°å¤šè¿œ,å–å†³äºä½ å¡«å‘èƒ½åŠ›æœ‰å¤šå¼º</strong>&gt;<br><img src="https://s2.ax1x.com/2019/10/03/uwX5Zj.jpg" alt="uwX5Zj.jpg"></p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;ç©è½¬Solræºç ä¹‹â€”Solræºç Deploy&quot;&gt;&lt;a href=&quot;#ç©è½¬Solræºç ä¹‹â€”Solræºç Deploy&quot; class=&quot;headerlink&quot; title=&quot;ç©è½¬Solræºç ä¹‹â€”Solræºç Deploy&quot;&gt;&lt;/a&gt;&lt;font color=&quot;#0077bb&quot;&gt;ç©è½¬Solræºç ä¹‹â€”Solræºç Deploy&lt;/font&gt;&lt;/h1&gt;&lt;p&gt;è¿™ç¯‡æ–‡ç« æ˜¯&lt;strong&gt;ç©è½¬Solræºç &lt;/strong&gt;ç³»åˆ—çš„ç¬¬ä¸‰ç¯‡ï¼Œç´§æ¥ç€ä¸Šä¸€ç¯‡çš„&lt;a href=&quot;https://www.fengqinglei.top/2019/10/01/solr-source-code-debug/&quot;&gt;æºç Deug&lt;/a&gt;ã€‚å¦‚æœä½ å·²ç»ä¿®æ”¹å¥½äº†æºç ï¼Œå¹¶ä¸”è°ƒè¯•okï¼Œæƒ³è¦å°†æºç æ‰“åŒ…ååˆ†å‘ç»™åŒæ—¶æˆ–è€…å…¶ä»–é¡¹ç›®å¼•ç”¨ï¼Œé‚£ä¹ˆè¿™è¾¹æ–‡ç« ä¸€å®šèƒ½å¤Ÿå¸®åŠ©ä½ ã€‚&lt;br&gt;
    
    </summary>
    
    
      <category term="Solr" scheme="https://www.fengqinglei.top/tags/Solr/"/>
    
      <category term="æºç " scheme="https://www.fengqinglei.top/tags/%E6%BA%90%E7%A0%81/"/>
    
      <category term="Deploy" scheme="https://www.fengqinglei.top/tags/Deploy/"/>
    
      <category term="éƒ¨ç½²" scheme="https://www.fengqinglei.top/tags/%E9%83%A8%E7%BD%B2/"/>
    
      <category term="Nexus" scheme="https://www.fengqinglei.top/tags/Nexus/"/>
    
      <category term="Maven" scheme="https://www.fengqinglei.top/tags/Maven/"/>
    
  </entry>
  
  <entry>
    <title>ç©è½¬Solræºç ä¹‹(äºŒ)Solræºç Debug</title>
    <link href="https://www.fengqinglei.top/2019/10/01/solr-source-code-debug/"/>
    <id>https://www.fengqinglei.top/2019/10/01/solr-source-code-debug/</id>
    <published>2019-10-01T14:19:40.000Z</published>
    <updated>2019-10-03T02:33:08.974Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ç©è½¬Solræºç ä¹‹â€”Solræºç Debug"><a href="#ç©è½¬Solræºç ä¹‹â€”Solræºç Debug" class="headerlink" title="ç©è½¬Solræºç ä¹‹â€”Solræºç Debug"></a><font color="#0077bb">ç©è½¬Solræºç ä¹‹â€”Solræºç Debug</font></h1><p>è¿™ç¯‡æ–‡ç« æ˜¯<strong>ç©è½¬Solræºç </strong>ç³»åˆ—çš„ç¬¬äºŒç¯‡ï¼Œç´§æ¥ç€ä¸Šä¸€ç¯‡çš„<a href="https://www.fengqinglei.top/2019/10/01/solr-source-code-import/">æºç å¯¼å…¥</a>ï¼Œå¦‚æœä½ è¿˜å¯¹å¦‚ä½•å°†Solræºç å¯¼å…¥åˆ°IDEè¿˜ä¸äº†è§£çš„è¯ï¼Œå»ºè®®å…ˆçœ‹<strong>æºç å¯¼å…¥</strong>çš„éƒ¨åˆ†ã€‚</p><h2 id="å®šä½æºç å…¥å£"><a href="#å®šä½æºç å…¥å£" class="headerlink" title="å®šä½æºç å…¥å£"></a><font color="#2C3E50">å®šä½æºç å…¥å£</font></h2><p>Solr çš„æºç å…¥å£ä¸º<strong>org.apache.solr.client.solrj.StartSolrJetty</strong>,ä¸»æ–¹æ³•ä¹Ÿæ¯”è¾ƒç®€çŸ­,<br><a id="more"></a><br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">( String[] args )</span> </span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">    <span class="comment">//System.setProperty("solr.solr.home", "../../../example/solr");</span></span><br><span class="line"></span><br><span class="line">    Server server = <span class="keyword">new</span> Server();</span><br><span class="line">    ServerConnector connector = <span class="keyword">new</span> ServerConnector(server, <span class="keyword">new</span> HttpConnectionFactory());</span><br><span class="line">    <span class="comment">// Set some timeout options to make debugging easier.</span></span><br><span class="line">    connector.setIdleTimeout(<span class="number">1000</span> * <span class="number">60</span> * <span class="number">60</span>);</span><br><span class="line">    connector.setSoLingerTime(-<span class="number">1</span>);</span><br><span class="line">    connector.setPort(<span class="number">8983</span>);</span><br><span class="line">    server.setConnectors(<span class="keyword">new</span> Connector[] &#123; connector &#125;);</span><br><span class="line">    </span><br><span class="line">    WebAppContext bb = <span class="keyword">new</span> WebAppContext();</span><br><span class="line">    bb.setServer(server);</span><br><span class="line">    bb.setContextPath(<span class="string">"/solr"</span>);</span><br><span class="line">    bb.setWar(<span class="string">"webapp/web"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//    // START JMX SERVER</span></span><br><span class="line"><span class="comment">//    if( true ) &#123;</span></span><br><span class="line"><span class="comment">//      MBeanServer mBeanServer = ManagementFactory.getPlatformMBeanServer();</span></span><br><span class="line"><span class="comment">//      MBeanContainer mBeanContainer = new MBeanContainer(mBeanServer);</span></span><br><span class="line"><span class="comment">//      server.getContainer().addEventListener(mBeanContainer);</span></span><br><span class="line"><span class="comment">//      mBeanContainer.start();</span></span><br><span class="line"><span class="comment">//    &#125;</span></span><br><span class="line">    </span><br><span class="line">    server.setHandler(bb);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      System.out.println(<span class="string">"&gt;&gt;&gt; STARTING EMBEDDED JETTY SERVER, PRESS ANY KEY TO STOP"</span>);</span><br><span class="line">      server.start();</span><br><span class="line">      <span class="keyword">while</span> (System.in.available() == <span class="number">0</span>) &#123;</span><br><span class="line">        Thread.sleep(<span class="number">5000</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      server.stop();</span><br><span class="line">      server.join();</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">      e.printStackTrace();</span><br><span class="line">      System.exit(<span class="number">100</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></p><h2 id="é…ç½®Solr-Home"><a href="#é…ç½®Solr-Home" class="headerlink" title="é…ç½®Solr Home"></a><font color="#2C3E50">é…ç½®Solr Home</font></h2><p>ä¸ºäº†èƒ½å¤Ÿè¿›è¡Œæºç çš„bugï¼Œæˆ‘ä»¬éœ€è¦é…ç½®å¥½solr_home,è¿™é‡Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨å®˜æ–¹çš„Solrå‘è¡ŒåŒ…ä¸­çš„exampleæ¥åšæ¼”ç¤ºï¼ˆçœŸå®çš„å¼€å‘ä¸­ï¼Œä¸€èˆ¬ä¼šæœ‰è‡ªå·±å®šä¹‰å¥½çš„solr_homeï¼‰ï¼Œç›´æ¥ä¸‹è½½solrçš„å‘è¡ŒåŒ…(è¿™é‡Œä»¥solr-7.7.2ä¸ºä¾‹å­)<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~/Documents</span><br><span class="line">curl <span class="string">"http://mirrors.tuna.tsinghua.edu.cn/apache/lucene/solr/7.7.2/solr-7.7.2.tgz"</span> -o solr-7.7.2.tgz &amp;&amp; tar -xvf solr-7.7.2.tgz</span><br><span class="line">mkdir solr_home &amp;&amp; <span class="built_in">cd</span> solr_home</span><br><span class="line">cp ~/Documents/solr-7.7.2/server/solr/solr.xml ./</span><br><span class="line">cp -r ~/Documents/solr-7.7.2/server/solr/configsets/sample_techproducts_configs ./</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"collection=TEST"</span> &gt; sample_techproducts_configs/core.properties</span><br></pre></td></tr></table></figure></p><p>è¿™é‡Œç®€å•è§£é‡Šä¸‹æœ€åä¸€ä¸ªå‘½ä»¤(echo â€œcollection=TEST â€¦â€)çš„å«ä¹‰,Solrä¸­æœ‰collectionå’Œcoreçš„æ¦‚å¿µã€‚</p><blockquote><ul><li>Collection<br>Solrä¸­çš„collectionç”±ä¸€ä¸ªæˆ–è€…å¤šä¸ªcoreç»„æˆï¼Œä¸€ä¸ªcollectionå¯¹åº”ä¸€ä»½ç‹¬ç«‹çš„configï¼Œåœ¨å•èŠ‚ç‚¹çš„æ¨¡å¼ä¸‹ï¼Œcoreå’Œcollectionæ˜¯ç­‰ä»·çš„,åœ¨é›†ç¾¤æ¨¡å¼ä¸‹ï¼Œä¸€ä¸ªcollectionä¼šæœ‰å¤šä¸ªåˆ†ç‰‡(shard)ç»„æˆï¼Œæ¯ä¸ªåˆ†ç‰‡åˆå¯ä»¥åˆå¤šä¸ªå‰¯æœ¬(replica),æ¯ä¸ªshardå¯¹åº”ä¸€ä¸ªcore</li><li>core<br>Solrä¸­çš„coreæ˜¯ä¸€ä¸ªåŒ…å«indexå’Œconfigçš„è¿è¡Œå®ä¾‹<h2 id="é…ç½®StartSolrJetty"><a href="#é…ç½®StartSolrJetty" class="headerlink" title="é…ç½®StartSolrJetty"></a><font color="#2C3E50">é…ç½®StartSolrJetty</font></h2>solrä¸­çš„solr_home å¯ä»¥é€šè¿‡é€šè¿‡ç¯å¢ƒå˜é‡è¿›è¡Œè®¾ç½®ï¼Œç›´æ¥ä¸Šä»£ç <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">System.setProperty(<span class="string">"solr.solr.home"</span>, <span class="string">"/home/fql/Documents/solr_home"</span>);</span><br></pre></td></tr></table></figure></li></ul></blockquote><p>è¿˜æœ‰ä¸€ä¸ªåœ°æ–¹éœ€è¦æ”¹åŠ¨ï¼Œå¦åˆ™ç¨‹åºæ— æ³•æ­£å¸¸å¯åŠ¨ï¼Œç›´æ¥ä¸Šä»£ç <br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bb.setWar(<span class="string">"webapp/web"</span>); ==&gt; bb.setWar(<span class="string">"solr/webapp/web"</span>);</span><br></pre></td></tr></table></figure></p><p>è®¾ç½®å®Œæ¯•ä¹‹åå°±å¯ä»¥å¯åŠ¨<strong>StartSolrJetty</strong>åç›´æ¥åœ¨æµè§ˆå™¨ä¸­è¾“å…¥<a href="http://127.0.0.1:8983/solrå°±å¯ä»¥å¼€å§‹ç•…æ¸¸solrçš„æºç å•¦.![æœ¬åœ°è®¿é—®](https://s2.ax1x.com/2019/10/02/udq8Tx.png" target="_blank" rel="noopener">http://127.0.0.1:8983/solrå°±å¯ä»¥å¼€å§‹ç•…æ¸¸solrçš„æºç å•¦.![æœ¬åœ°è®¿é—®](https://s2.ax1x.com/2019/10/02/udq8Tx.png</a>)</p><h3 id="å°æŠ€å·§"><a href="#å°æŠ€å·§" class="headerlink" title="å°æŠ€å·§"></a><font color="#2C3E50">å°æŠ€å·§</font></h3><p>StartSolrJettyé»˜è®¤çš„é…ç½®æ˜¯æ²¡æœ‰å¤ªå¤šçš„æ—¥å¿—è¾“å‡ºçš„ï¼Œä½†æ˜¯æ—¢ç„¶æˆ‘ä»¬éƒ½å·²ç»å¼€å§‹debug solrçš„æºä»£ç äº†ï¼Œè¿˜æ˜¯è¾“å‡ºæ›´å¤šçš„æ—¥å¿—å¸®åŠ©æˆ‘ä»¬æ›´å¥½çš„åˆ†ææºç å§ï¼ŒåŒæ ·ï¼Œå¼€å¯debugæ—¥å¿—çš„ä»£ç ä¹Ÿæ¯”è¾ƒç®€å•<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">System.setProperty(<span class="string">"log4j2.debug"</span>,<span class="string">"true"</span>);</span><br></pre></td></tr></table></figure></p><p>è¿™æ ·æˆ‘ä»¬å°±å‰‹æœ‰çœ‹åˆ°æ‰€æœ‰çš„æ—¥å¿—å•¦ã€‚ä¸‹ä¸€ç¯‡æˆ‘ä»¬å°†è¦ä»‹ç»å¦‚æœå°†ä¿®æ”¹è¿‡çš„solræºç éƒ¨ç½²åˆ°å…¬å¸æˆ–è€…ä¸ªäººçš„nexusä»“åº“,ä¹Ÿæ˜¯æœ¬ç³»åˆ—çš„æœ€åä¸€ç¯‡ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;ç©è½¬Solræºç ä¹‹â€”Solræºç Debug&quot;&gt;&lt;a href=&quot;#ç©è½¬Solræºç ä¹‹â€”Solræºç Debug&quot; class=&quot;headerlink&quot; title=&quot;ç©è½¬Solræºç ä¹‹â€”Solræºç Debug&quot;&gt;&lt;/a&gt;&lt;font color=&quot;#0077bb&quot;&gt;ç©è½¬Solræºç ä¹‹â€”Solræºç Debug&lt;/font&gt;&lt;/h1&gt;&lt;p&gt;è¿™ç¯‡æ–‡ç« æ˜¯&lt;strong&gt;ç©è½¬Solræºç &lt;/strong&gt;ç³»åˆ—çš„ç¬¬äºŒç¯‡ï¼Œç´§æ¥ç€ä¸Šä¸€ç¯‡çš„&lt;a href=&quot;https://www.fengqinglei.top/2019/10/01/solr-source-code-import/&quot;&gt;æºç å¯¼å…¥&lt;/a&gt;ï¼Œå¦‚æœä½ è¿˜å¯¹å¦‚ä½•å°†Solræºç å¯¼å…¥åˆ°IDEè¿˜ä¸äº†è§£çš„è¯ï¼Œå»ºè®®å…ˆçœ‹&lt;strong&gt;æºç å¯¼å…¥&lt;/strong&gt;çš„éƒ¨åˆ†ã€‚&lt;/p&gt;
&lt;h2 id=&quot;å®šä½æºç å…¥å£&quot;&gt;&lt;a href=&quot;#å®šä½æºç å…¥å£&quot; class=&quot;headerlink&quot; title=&quot;å®šä½æºç å…¥å£&quot;&gt;&lt;/a&gt;&lt;font color=&quot;#2C3E50&quot;&gt;å®šä½æºç å…¥å£&lt;/font&gt;&lt;/h2&gt;&lt;p&gt;Solr çš„æºç å…¥å£ä¸º&lt;strong&gt;org.apache.solr.client.solrj.StartSolrJetty&lt;/strong&gt;,ä¸»æ–¹æ³•ä¹Ÿæ¯”è¾ƒç®€çŸ­,&lt;br&gt;
    
    </summary>
    
    
      <category term="Solr" scheme="https://www.fengqinglei.top/tags/Solr/"/>
    
      <category term="Debug" scheme="https://www.fengqinglei.top/tags/Debug/"/>
    
      <category term="æºç " scheme="https://www.fengqinglei.top/tags/%E6%BA%90%E7%A0%81/"/>
    
      <category term="è°ƒè¯•" scheme="https://www.fengqinglei.top/tags/%E8%B0%83%E8%AF%95/"/>
    
  </entry>
  
  <entry>
    <title>ç©è½¬Solræºç ä¹‹(ä¸€)Solræºç å¯¼å…¥IDE</title>
    <link href="https://www.fengqinglei.top/2019/10/01/solr-source-code-import/"/>
    <id>https://www.fengqinglei.top/2019/10/01/solr-source-code-import/</id>
    <published>2019-10-01T07:47:33.000Z</published>
    <updated>2019-10-02T13:30:57.770Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ç©è½¬Solræºç ä¹‹â€”Solræºç å¯¼å…¥IDE"><a href="#ç©è½¬Solræºç ä¹‹â€”Solræºç å¯¼å…¥IDE" class="headerlink" title="ç©è½¬Solræºç ä¹‹â€”Solræºç å¯¼å…¥IDE"></a><font color="#0077bb">ç©è½¬Solræºç ä¹‹â€”Solræºç å¯¼å…¥IDE</font></h1><h2 id="æºç ä¸‹è½½"><a href="#æºç ä¸‹è½½" class="headerlink" title="æºç ä¸‹è½½"></a><font color="#2C3E50">æºç ä¸‹è½½</font></h2><p>è¿™ä¸ªæ¯”è¾ƒç®€å•,ç›´æ¥åˆ°solrçš„å®˜ç½‘ä¸Šä¸‹è½½æºç å³å¯,è¿™é‡Œä»¥<a href="https://www.apache.org/dyn/closer.lua/lucene/solr/7.7.2/solr-7.7.2-src.tgz" target="_blank" rel="noopener">Solr 7.7.2</a>ä¸ºä¾‹å­ã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl <span class="string">"https://www.apache.org/dyn/closer.lua/lucene/solr/7.7.2/solr-7.7.2-src.tgz"</span> -o solr-7.7.2-src.tgz &amp;&amp; tar -xvf solr-7.7.2-src.tgz</span><br></pre></td></tr></table></figure></p><h2 id="å®‰è£…ä¾èµ–"><a href="#å®‰è£…ä¾èµ–" class="headerlink" title="å®‰è£…ä¾èµ–"></a><font color="#2C3E50">å®‰è£…ä¾èµ–</font></h2><blockquote><ul><li>jdk 1.8 </li><li>ant</li></ul></blockquote><p>ç¬”è€…ä½¿ç”¨çš„æ˜¯RedHat ç³»ç»Ÿï¼Œæ‰€ä»¥jdkçš„å®‰è£…ç›´æ¥ä½¿ç”¨yumå°±è¡Œ<br><a id="more"></a><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install  java-1.8.0-openjdk-devel.x86_64</span><br></pre></td></tr></table></figure></p><p>antéœ€è¦é…ç½®ä¸€ä¸‹ç¯å¢ƒï¼Œä¹Ÿä¸ç®—å¤æ‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">curl <span class="string">"http://mirrors.tuna.tsinghua.edu.cn/apache//ant/binaries/apache-ant-1.9.14-bin.tar.gz"</span> -o apache-ant-1.9.14-bin.tar.gz</span><br><span class="line">tar -xvf apache-ant-1.9.14-bin.tar.gz</span><br><span class="line">rm -rf apache-ant-1.9.14-bin.tar.gz</span><br></pre></td></tr></table></figure></p><p>é…ç½®ç¯å¢ƒå˜é‡(ä»¥RedHatä¸ºä¾‹),è¿½åŠ ä»¥ä¸‹ä¿¡æ¯åˆ°~/.bash_profile (~/.bash_profile)ï¼Œè¿™é‡Œæˆ‘æŠŠantå®‰è£…åˆ°äº†/optç›®å½•ä¸‹<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> ANT_HOME=/opt/apache-ant-1.9.14</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="variable">$ANT_HOME</span>/bin</span><br></pre></td></tr></table></figure></p><p>ç®€å•éªŒè¯ä¸‹ï¼Œçœ‹åˆ°ä»¥ä¸‹ç»“æœå°±ç®—okäº†(source ~/.bash_profile æ˜¯ä¸ºäº†ä½¿åˆšåˆšçš„é…ç½®ç”Ÿæ•ˆ)<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$source</span> ~/.bash_profile</span><br><span class="line"><span class="variable">$ant</span> -version</span><br><span class="line">Apache Ant(TM) version 1.9.14 compiled on March 12 2019</span><br></pre></td></tr></table></figure></p><h2 id="Buildæºç "><a href="#Buildæºç " class="headerlink" title="Buildæºç "></a><font color="#2C3E50">Buildæºç </font></h2><p>Solrçš„æºç æ˜¯ä½¿ç”¨ivyæ¥ç®¡ç†ä¾èµ–çš„ï¼Œæ‰€ä»¥éœ€è¦å®‰è£…ivyçš„libåŒ…ï¼Œä½†æ˜¯Solrçš„é¡¹ç›®ä¸­å¯ä»¥é€šè¿‡<strong>ant ivy-bootstrap</strong>ç›´æ¥ä¸‹è½½ivyçš„jaråŒ…,è¿™é‡Œçœ‹åˆ°â€BUILD SUCCESSFULâ€è¡¨ç¤ºæ‰§è¡ŒæˆåŠŸäº†ã€‚<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$cd</span> solr-7.7.2</span><br><span class="line"><span class="variable">$ant</span> ivy-bootstrap</span><br><span class="line">-ivy-bootstrap1:</span><br><span class="line">    [mkdir] Created dir: /home/fql/.ant/lib</span><br><span class="line">     [<span class="built_in">echo</span>] installing ivy 2.4.0 to /home/fql/.ant/lib</span><br><span class="line">      [get] Getting: https://repo1.maven.org/maven2/org/apache/ivy/ivy/2.4.0/ivy-2.4.0.jar</span><br><span class="line">      [get] To: /home/fql/.ant/lib/ivy-2.4.0.jar</span><br><span class="line">-ivy-bootstrap2:</span><br><span class="line">-ivy-checksum:</span><br><span class="line">-ivy-remove-old-versions:</span><br><span class="line">ivy-bootstrap:</span><br><span class="line">BUILD SUCCESSFUL</span><br></pre></td></tr></table></figure></p><h2 id="ç”ŸæˆIntelij-Idea-Eclipseé¡¹ç›®"><a href="#ç”ŸæˆIntelij-Idea-Eclipseé¡¹ç›®" class="headerlink" title="ç”ŸæˆIntelij Idea/Eclipseé¡¹ç›®"></a><font color="#2C3E50">ç”ŸæˆIntelij Idea/Eclipseé¡¹ç›®</font></h2><p>Intelij Idea æ˜¯ç¬”è€…ä»2013å¹´å¼€å§‹ç”¨çš„ï¼Œä¹‹å‰ç”¨çš„éƒ½æ˜¯Eclipse,è¿™é‡Œä¸æ¯”è¾ƒä¸¤ä¸ªå·¥å…·çš„å¥½åï¼Œèƒ½å®Œæˆé¡¹ç›®å¼€å‘å°±è¡Œï¼Œè¿™é‡Œä»¥å¯¼å…¥Intellij Idea ä¸ºä¾‹å­ (å¦‚æœæ˜¯eclipseåˆ™ä¸º<strong>ant eclipse</strong>)<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$cd</span> solr-7.7.2</span><br><span class="line"><span class="variable">$ant</span> idea</span><br></pre></td></tr></table></figure></p><p>è¿™ä¸ªæ‰§è¡Œçš„è¿‡ç¨‹æ¯”è¾ƒé•¿ï¼Œæ˜¯å› ä¸ºivyä¼šä»mavençš„å®˜æ–¹repoä¸‹è½½ä¾èµ–,è¿™é‡Œå¯ä»¥å»å–æ¯èŒ¶ç­‰ç€ç¨‹åºè‡ªåŠ¨æ‰§è¡Œå®Œæˆå°±è¡Œ.</p><h4 id="å¦‚ä½•è§£å†³ä¸‹è½½ä¸äº†org-restletæ‰“å¤´çš„åŒ…"><a href="#å¦‚ä½•è§£å†³ä¸‹è½½ä¸äº†org-restletæ‰“å¤´çš„åŒ…" class="headerlink" title="å¦‚ä½•è§£å†³ä¸‹è½½ä¸äº†org.restletæ‰“å¤´çš„åŒ…"></a><font color="#2C3E50">å¦‚ä½•è§£å†³ä¸‹è½½ä¸äº†org.restletæ‰“å¤´çš„åŒ…</font></h4><p>å¯èƒ½ä½ åœ¨æ‰§è¡Œant testçš„æ—¶å€™ä¼šé‡åˆ°ç±»ä¼¼ä»¥ä¸‹çš„é”™è¯¯<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">resolve:</span><br><span class="line">[ivy:retrieve] </span><br><span class="line">[ivy:retrieve] :: problems summary ::</span><br><span class="line">[ivy:retrieve] :::: WARNINGS</span><br><span class="line">[ivy:retrieve] [FAILED     ] org.restlet.jee#org.restlet;2.3.0!org.restlet.jar:  (0ms)</span><br><span class="line">[ivy:retrieve] ==== shared: tried</span><br><span class="line">[ivy:retrieve]   /home/fql/.ivy2/shared/org.restlet.jee/org.restlet/2.3.0/jars/org.restlet.jar</span><br><span class="line">[ivy:retrieve] ==== public: tried</span><br><span class="line">[ivy:retrieve]   https://repo1.maven.org/maven2/org/restlet/jee/org.restlet/2.3.0/org.restlet-2.3.0.jar</span><br><span class="line">[ivy:retrieve] [FAILED     ] org.restlet.jee#org.restlet.ext.servlet;2.3.0!org.restlet.ext.servlet.jar:  (0ms)</span><br><span class="line">[ivy:retrieve] ==== shared: tried</span><br><span class="line">[ivy:retrieve]   /home/fql/.ivy2/shared/org.restlet.jee/org.restlet.ext.servlet/2.3.0/jars/org.restlet.ext.servlet.jar</span><br><span class="line">[ivy:retrieve] ==== public: tried</span><br><span class="line">[ivy:retrieve]   https://repo1.maven.org/maven2/org/restlet/jee/org.restlet.ext.servlet/2.3.0/org.restlet.ext.servlet-2.3.0.jar</span><br><span class="line">[ivy:retrieve] ::::::::::::::::::::::::::::::::::::::::::::::</span><br><span class="line">[ivy:retrieve] ::              FAILED DOWNLOADS            ::</span><br><span class="line">[ivy:retrieve] :: ^ see resolution messages for details  ^ ::</span><br><span class="line">[ivy:retrieve] ::::::::::::::::::::::::::::::::::::::::::::::</span><br><span class="line">[ivy:retrieve] :: org.restlet.jee#org.restlet;2.3.0!org.restlet.jar</span><br><span class="line">[ivy:retrieve] :: org.restlet.jee#org.restlet.ext.servlet;2.3.0!org.restlet.ext.servlet.jar</span><br><span class="line">[ivy:retrieve] ::::::::::::::::::::::::::::::::::::::::::::::</span><br><span class="line">[ivy:retrieve] </span><br><span class="line">[ivy:retrieve] :: USE VERBOSE OR DEBUG MESSAGE LEVEL FOR MORE DETAILS</span><br><span class="line"></span><br><span class="line">BUILD FAILED</span><br><span class="line">/home/fql/IdeaProjects/solr-7.7.2/build.xml:140: The following error occurred while executing this line:</span><br><span class="line">/home/fql/IdeaProjects/solr-7.7.2/solr/build.xml:602: The following error occurred while executing this line:</span><br><span class="line">/home/fql/IdeaProjects/solr-7.7.2/solr/core/build.xml:68: impossible to resolve dependencies:</span><br><span class="line">resolve failed - see output for details</span><br></pre></td></tr></table></figure></p><p>è¿™æ˜¯å› ä¸ºè¿™ä¸ªä¾èµ–çš„ç›®å½•å·²ç»åœ¨~/.ivy2/cacheä¸‹é¢çš„ç›®å½•ç”Ÿæˆäº†ï¼Œä½†æ˜¯jarä¸‹è½½å¤±è´¥å¯¼è‡´çš„ï¼Œç›´æ¥åˆ é™¤å¯¹åº”çš„ç›®å½•é‡æ–°æ‰§è¡Œ<strong>ant test</strong> å°±è¡Œäº†,ä»¥ä¸Šé¢çš„é”™è¯¯ä¸ºä¾‹ï¼Œå…·ä½“æ‰§è¡Œçš„å‘½ä»¤ä¸º<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rm -rf ~/.ivy2/cache/org.restlet*</span><br><span class="line">ant <span class="built_in">test</span></span><br></pre></td></tr></table></figure></p><h2 id="å¯¼å…¥Idea"><a href="#å¯¼å…¥Idea" class="headerlink" title="å¯¼å…¥Idea"></a><font color="#2C3E50">å¯¼å…¥Idea</font></h2><p>æ‰§è¡Œå®Œ<strong>ant idea</strong>ä¹‹åï¼Œå¦‚æœçœ‹è§ä»¥ä¸‹ç±»ä¼¼è¾“å‡ºè¡¨ç¤ºbuildæˆåŠŸï¼Œæˆ‘ä»¬å¯ä»¥å¼€å§‹å°†é¡¹ç›®å¯¼å…¥<strong>Intelij Idea</strong>äº†<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">-post-idea-instructions:</span><br><span class="line">     [echo] </span><br><span class="line">     [echo] To complete IntelliJ IDEA setup, you must manually configure</span><br><span class="line">     [echo] File | Project Structure | Project | Project SDK.</span><br><span class="line">     [echo]       </span><br><span class="line">     [echo] You won&apos;t have to do this in the future if you define property</span><br><span class="line">     [echo] $&#123;idea.jdk&#125;, e.g. in ~/lucene.build.properties, ~/build.properties</span><br><span class="line">     [echo] or lucene/build.properties, with a value consisting of the</span><br><span class="line">     [echo] following two XML attributes/values (adjust values according to</span><br><span class="line">     [echo] JDKs you have defined locally - see </span><br><span class="line">     [echo] File | Project Structure | Platform Settings | SDKs):</span><br><span class="line">     [echo] </span><br><span class="line">     [echo]     idea.jdk = project-jdk-name=&quot;1.8&quot; project-jdk-type=&quot;JavaSDK&quot;</span><br><span class="line">     [echo]     </span><br><span class="line"></span><br><span class="line">BUILD SUCCESSFUL</span><br></pre></td></tr></table></figure></p><p>æ‰“å¼€Intelij Idea , é€‰æ‹©æ–‡ä»¶-&gt;æ‰“å¼€-&gt;é€‰æ‹©æºç çš„è·¯å¾„æ‰“å¼€å³å¯,Eclipse ç›´æ¥é€‰æ‹©ä»æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿä¸­æ‰“å¼€é¡¹ç›®å³å¯ã€‚<br><img src="https://s2.ax1x.com/2019/10/01/uUfCDg.png" alt="é¡¹ç›®å¯¼å…¥"><br>è‡³æ­¤ï¼Œæˆ‘ä»¬å·²ç»å®Œæˆå°†é¡¹ç›®å¯¼å…¥åˆ°Intelij Ideaï¼Œä¸‹é¢æˆ‘ä¼šåˆ†äº«å¦‚ä½•åœ¨Intelij Ideaä¸­debug Solr çš„æºç ã€‚</p><h2 id="å‚è€ƒçš„ç½‘å€"><a href="#å‚è€ƒçš„ç½‘å€" class="headerlink" title="å‚è€ƒçš„ç½‘å€"></a><font color="#2C3E50">å‚è€ƒçš„ç½‘å€</font></h2><blockquote><ul><li><a href="https://stackoverflow.com/questions/30630227/java-ivy-maven-build-dependency-resolution-for-lucidworks-auto-phrase-tokenizer" target="_blank" rel="noopener">https://stackoverflow.com/questions/30630227/java-ivy-maven-build-dependency-resolution-for-lucidworks-auto-phrase-tokenizer</a></li></ul></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;ç©è½¬Solræºç ä¹‹â€”Solræºç å¯¼å…¥IDE&quot;&gt;&lt;a href=&quot;#ç©è½¬Solræºç ä¹‹â€”Solræºç å¯¼å…¥IDE&quot; class=&quot;headerlink&quot; title=&quot;ç©è½¬Solræºç ä¹‹â€”Solræºç å¯¼å…¥IDE&quot;&gt;&lt;/a&gt;&lt;font color=&quot;#0077bb&quot;&gt;ç©è½¬Solræºç ä¹‹â€”Solræºç å¯¼å…¥IDE&lt;/font&gt;&lt;/h1&gt;&lt;h2 id=&quot;æºç ä¸‹è½½&quot;&gt;&lt;a href=&quot;#æºç ä¸‹è½½&quot; class=&quot;headerlink&quot; title=&quot;æºç ä¸‹è½½&quot;&gt;&lt;/a&gt;&lt;font color=&quot;#2C3E50&quot;&gt;æºç ä¸‹è½½&lt;/font&gt;&lt;/h2&gt;&lt;p&gt;è¿™ä¸ªæ¯”è¾ƒç®€å•,ç›´æ¥åˆ°solrçš„å®˜ç½‘ä¸Šä¸‹è½½æºç å³å¯,è¿™é‡Œä»¥&lt;a href=&quot;https://www.apache.org/dyn/closer.lua/lucene/solr/7.7.2/solr-7.7.2-src.tgz&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Solr 7.7.2&lt;/a&gt;ä¸ºä¾‹å­ã€‚&lt;br&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;curl &lt;span class=&quot;string&quot;&gt;&quot;https://www.apache.org/dyn/closer.lua/lucene/solr/7.7.2/solr-7.7.2-src.tgz&quot;&lt;/span&gt; -o solr-7.7.2-src.tgz &amp;amp;&amp;amp; tar -xvf solr-7.7.2-src.tgz&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;h2 id=&quot;å®‰è£…ä¾èµ–&quot;&gt;&lt;a href=&quot;#å®‰è£…ä¾èµ–&quot; class=&quot;headerlink&quot; title=&quot;å®‰è£…ä¾èµ–&quot;&gt;&lt;/a&gt;&lt;font color=&quot;#2C3E50&quot;&gt;å®‰è£…ä¾èµ–&lt;/font&gt;&lt;/h2&gt;&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;jdk 1.8 &lt;/li&gt;
&lt;li&gt;ant&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;p&gt;ç¬”è€…ä½¿ç”¨çš„æ˜¯RedHat ç³»ç»Ÿï¼Œæ‰€ä»¥jdkçš„å®‰è£…ç›´æ¥ä½¿ç”¨yumå°±è¡Œ&lt;br&gt;
    
    </summary>
    
    
      <category term="Solr" scheme="https://www.fengqinglei.top/tags/Solr/"/>
    
      <category term="æºç " scheme="https://www.fengqinglei.top/tags/%E6%BA%90%E7%A0%81/"/>
    
      <category term="Intelij Idea" scheme="https://www.fengqinglei.top/tags/Intelij-Idea/"/>
    
      <category term="Eclipse" scheme="https://www.fengqinglei.top/tags/Eclipse/"/>
    
      <category term="ant" scheme="https://www.fengqinglei.top/tags/ant/"/>
    
  </entry>
  
  <entry>
    <title>IBM ICU ç®€ç¹è½¬æ¢å·¥å…·çš„æ€§èƒ½å‘</title>
    <link href="https://www.fengqinglei.top/2019/07/21/IBMICUSlowIssue/"/>
    <id>https://www.fengqinglei.top/2019/07/21/IBMICUSlowIssue/</id>
    <published>2019-07-21T06:33:05.000Z</published>
    <updated>2019-09-27T00:46:01.319Z</updated>
    
    <content type="html"><![CDATA[<h1 id="IBM-ICU-ç®€ç¹è½¬æ¢å·¥å…·çš„æ€§èƒ½å‘"><a href="#IBM-ICU-ç®€ç¹è½¬æ¢å·¥å…·çš„æ€§èƒ½å‘" class="headerlink" title="IBM ICU ç®€ç¹è½¬æ¢å·¥å…·çš„æ€§èƒ½å‘"></a><font color="#0077bb">IBM ICU ç®€ç¹è½¬æ¢å·¥å…·çš„æ€§èƒ½å‘</font></h1><h2 id="èƒŒæ™¯ä»‹ç»"><a href="#èƒŒæ™¯ä»‹ç»" class="headerlink" title="èƒŒæ™¯ä»‹ç»"></a><font color="#2C3E50">èƒŒæ™¯ä»‹ç»</font></h2><p>ç”±äºå·¥ä½œå†…å®¹çš„éœ€è¦ï¼Œæˆ‘ä»¬å¤„ç†çš„æ–‡æœ¬æ•°æ®ä¸­ä¼šæœ‰ç¹ä½“ä¸­æ–‡ï¼Œä½†æ˜¯æˆ‘ä»¬çš„äº§å“çš„ä½¿ç”¨å®¢æˆ·éƒ½æ˜¯ä¹ æƒ¯ä½¿ç”¨ç®€ä½“ä¸­æ–‡ï¼ˆå°æ¹¾æ˜¯ä¸­å›½ä¸å¯å‰²èˆçš„ä¸€éƒ¨åˆ†ï¼‰ï¼Œæ‰€ä»¥ä¸ºäº†æ–¹ä¾¿ç”¨æˆ·ä½¿ç”¨ç®€ä½“ä¸­æ–‡æ£€ç´¢åˆ°ç¹ä½“ä¸­æ–‡ï¼Œæˆ‘ä»¬éœ€è¦åœ¨å»ºç«‹ç´¢å¼•çš„æ—¶å€™ï¼ˆè¿™é‡Œä»¥solrä¸ºä¾‹å­ï¼‰è¿›è¡Œç®€ç¹è½¬æ¢ã€‚ç®€å•çš„æŸ¥çœ‹äº†Solrçš„æ–‡æ¡£ï¼Œä»¥åŠç®€å•çš„ç™¾åº¦æˆ–è€…Google, æˆ‘ä»¬å¯ä»¥åœ¨Solr(7.7.2)ä¸­æ·»åŠ ä»¥ä¸‹çš„å­—æ®µç±»å‹æ¥è¿›è¡Œä¸­æ–‡åˆ†è¯å’Œç®€ç¹è½¬æ¢ã€‚<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">fieldType</span> <span class="attr">name</span>=<span class="string">"test"</span>  <span class="attr">class</span>=<span class="string">"solr.TextField"</span> &gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">analyzer</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">charFilter</span> <span class="attr">class</span>=<span class="string">"solr.HTMLStripCharFilterFactory"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">charFilter</span> <span class="attr">class</span>=<span class="string">"solr.MappingCharFilterFactory"</span> <span class="attr">mapping</span>=<span class="string">"mapping-ISOLatin1Accent.txt"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">tokenizer</span> <span class="attr">class</span>=<span class="string">"solr.StandardTokenizerFactory"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.CJKWidthFilterFactory"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.ICUTransformFilterFactory"</span> <span class="attr">id</span>=<span class="string">"Traditional-Simplified"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.LowerCaseFilterFactory"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.CJKBigramFilterFactory"</span> <span class="attr">han</span>=<span class="string">"true"</span> <span class="attr">outputUnigrams</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">analyzer</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">fieldType</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p>å¯ä»¥çœ‹åˆ°è¿™æ˜¯æœ€ç®€å•çš„ä¸­æ–‡åˆ†è¯å™¨-&gt; äºŒå…ƒåˆ†è¯ï¼Œå¹¶ä¸”åœ¨äºŒå…ƒçš„åŸºç¡€ä¸Šè¾“å‡ºäº†ä¸€å…ƒçš„ç»“æœï¼Œè¿™é‡Œå¯ä»¥ç®€å•çœ‹ä¸‹åˆ†è¯ç»“æœ<br><img src="https://s2.ax1x.com/2019/07/21/eCmvwt.png" alt="äºŒå…ƒ+ä¸€å…ƒåˆ†è¯æ•ˆæœ"><br>ä¼¼ä¹é…ç½®+ä½¿ç”¨èµ·æ¥ä¹Ÿå°±5s(666),ä½†æ˜¯å®é™…æƒ…å†µæ˜¯æ€§èƒ½ä¸å¤Ÿï¼Œå°„ä¸é«˜ï¼Œè·‘ä¸å¿«ã€‚<br><a id="more"></a></p><h2 id="å‘ç°é—®é¢˜"><a href="#å‘ç°é—®é¢˜" class="headerlink" title="å‘ç°é—®é¢˜"></a><font color="#2C3E50">å‘ç°é—®é¢˜</font></h2><p>å› ä¸ºæ˜¯éœ€è¦ä¸Šçº¿çš„æœåŠ¡ï¼Œæ‰€ä»¥ä¹ æƒ¯æ€§çš„éœ€è¦åœ¨æœ¬åœ°è¿›è¡Œä¸€äº›ç´¢å¼•å’ŒæŸ¥è¯¢çš„æ€§èƒ½æµ‹è¯•ï¼Œä¸ºäº†æµ‹è¯•ç´¢å¼•çš„æ€§èƒ½ï¼Œæˆ‘å‡†å¤‡äº†2700ä¸‡çš„æ–‡æ¡£æ•°æ®ï¼ˆåŒ…å«ç®€ä½“ä¸­æ–‡å’Œç¹ä½“ä¸­æ–‡ï¼‰ï¼Œè¿›è¡Œå‹ç¼©ä¹‹åè¿™äº›æ–‡æ¡£å¤§å°åœ¨135GBå·¦å³ï¼ŒåŸºæœ¬ä¸Šå¯ä»¥åšä¸€ä¸ªé•¿æ—¶é—´çš„æ€§èƒ½æ‘¸åº•æµ‹è¯•äº†ã€‚<br>æˆ‘ä»¬ç®€å•çš„çœ‹ä¸‹ç”¨æˆ·æµ‹è¯•çš„æœºå™¨é…ç½®</p><div class="table-container"><table><thead><tr><th style="text-align:center">æœºå™¨ç±»å‹</th><th style="text-align:center">CPU é…ç½®</th><th style="text-align:center">å†…å­˜é…ç½®</th><th style="text-align:center">ç£ç›˜é…ç½®</th></tr></thead><tbody><tr><td style="text-align:center">SolræœåŠ¡æœºå™¨</td><td style="text-align:center">12 Core Intel(R) Xeon(R) CPU E5-2420 v2 @ 2.20GHz</td><td style="text-align:center">30GB</td><td style="text-align:center">7TB LVM</td></tr><tr><td style="text-align:center">ç´¢å¼•æœºå™¨</td><td style="text-align:center">4 Core Intel(R) Core(TM) i5-4590 CPU @ 3.30GHz</td><td style="text-align:center">16GB</td><td style="text-align:center">1TB HDD</td></tr></tbody></table></div><p>å¹¶ä¸”<strong>ç´¢å¼•æœºå™¨</strong> å’Œ <strong>Solr æœåŠ¡æœºå™¨</strong> ä¹‹å‰çš„ç½‘ç»œä¸ºåƒå…†å¸¦å®½ï¼Œæ‰€ä»¥ç½‘ç»œä¸Šä¸ä¼šæˆä¸ºç“¶é¢ˆã€‚<br>å¹¶ä¸”Solr çš„ä¸€äº›é‡è¦é…ç½®ä¸º</p><blockquote><ul><li>å†…å­˜é…ç½®ä¸ºSOLR_JAVA_MEM=â€-Xms6144m -Xmx6144mâ€</li><li><p>ramBufferSizeMBé…ç½®ä¸º</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ramBufferSizeMB</span>&gt;</span>100<span class="tag">&lt;/<span class="name">ramBufferSizeMB</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>mergePolicyFactory ä¸º</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mergePolicyFactory</span> <span class="attr">class</span>=<span class="string">"org.apache.solr.index.TieredMergePolicyFactory"</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">int</span> <span class="attr">name</span>=<span class="string">"maxMergeAtOnce"</span>&gt;</span>30<span class="tag">&lt;/<span class="name">int</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">int</span> <span class="attr">name</span>=<span class="string">"segmentsPerTier"</span>&gt;</span>40<span class="tag">&lt;/<span class="name">int</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">double</span> <span class="attr">name</span>=<span class="string">"noCFSRatio"</span>&gt;</span>0<span class="tag">&lt;/<span class="name">double</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">int</span> <span class="attr">name</span>=<span class="string">"maxMergedSegmentMB"</span>&gt;</span>1024<span class="tag">&lt;/<span class="name">int</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mergePolicyFactory</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>mergeScheduler ä¸º</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mergeScheduler</span> <span class="attr">class</span>=<span class="string">"org.apache.lucene.index.ConcurrentMergeScheduler"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">int</span> <span class="attr">name</span>=<span class="string">"maxMergeCount"</span>&gt;</span>12<span class="tag">&lt;/<span class="name">int</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">int</span> <span class="attr">name</span>=<span class="string">"maxThreadCount"</span>&gt;</span>6<span class="tag">&lt;/<span class="name">int</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mergeScheduler</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>autoCommit çš„é…ç½®ä¸º (é˜²æ­¢é¢‘ç¹çš„autocommitç”Ÿæˆå¤ªå¤šçš„å°æ®µå¯¼è‡´Solrä¸€ç›´åœ¨åˆå¹¶æ®µ)</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">autoCommit</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">maxTime</span>&gt;</span>$&#123;solr.autoCommit.maxTime:180000&#125;<span class="tag">&lt;/<span class="name">maxTime</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">openSearcher</span>&gt;</span>false<span class="tag">&lt;/<span class="name">openSearcher</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">autoCommit</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul></blockquote><p>ä¸ºäº†ä»…å¯èƒ½çš„ç”¨å°½æœåŠ¡ç«¯çš„CPUï¼Œæˆ‘åœ¨å®¢æˆ·ç«¯å¼€äº†20ä¸ªçº¿ç¨‹å¾€æœåŠ¡ç«¯ä¸¢æ•°æ®ï¼Œç†è®ºä¸Šåº”è¯¥å¯ä»¥å°†æœåŠ¡ç«¯çš„cpuè·‘æ»¡ã€‚ä½†æ˜¯å®é™…çš„æœåŠ¡ç«¯cpuä½¿ç”¨æƒ…å†µä¸º<img src="https://s2.ax1x.com/2019/07/21/eCCX59.png" alt="Solr Server CPU usage"><br>å¹¶ä¸”å®¢æˆ·ç«¯çš„ç´¢å¼•é€Ÿåº¦åªæœ‰<strong>404 doc/s</strong> (å› ä¸ºå’Œå…·ä½“çš„æ–‡æ¡£çš„å¤§å°å’Œå†…å®¹æœ‰å…³ç³»ï¼Œé€Ÿåº¦çš„å€¼å¹¶æ²¡æœ‰å¤ªå¤šçš„å‚è€ƒæ„ä¹‰ï¼Œæˆ‘ä»¬éœ€è¦è§‚å¯Ÿçš„æ›´å¤šçš„é€Ÿåº¦çš„å˜åŒ–ç‡)<br>æ˜¾ç„¶è¿™ä¸ªç»“æœï¼ˆcpuä½¿ç”¨ç‡ï¼‰å’Œé¢„æœŸçš„ç›¸å·®éå¸¸å¤§ï¼Ÿä¸ºå•¥è¿˜æœ‰é‚£ä¹ˆå¤šçš„cpuèµ„æºåœ¨idl ï¼Ÿï¼Ÿ</p><h2 id="å®šä½é—®é¢˜"><a href="#å®šä½é—®é¢˜" class="headerlink" title="å®šä½é—®é¢˜"></a><font color="#2C3E50">å®šä½é—®é¢˜</font></h2><p>ä¸ºäº†ææ¸…æ¥šä¸ºå•¥ä¼šæœ‰è¿™ä¹ˆå¤šcpuåœ¨idlï¼Œæœ€ç®€å•çš„åŠæ³•å°±æ˜¯ä½¿ç”¨ä¸€äº›jvmçš„profileå·¥å…·ï¼Œå¯ä»¥çœ‹åˆ°cpuæŠŠå¤§é‡çš„èµ„æºæ¶ˆè€—åœ¨ä»€ä¹ˆåœ°æ–¹ï¼Œä»è€Œæˆ‘ä»¬å¯ä»¥å®šä½åˆ°å‘ç”Ÿé—®é¢˜çš„ä»£ç çš„ç±»ç”šè‡³æŸä¸€è¡Œï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨çš„å·¥å…·æ˜¯<a href="https://visualvm.github.io/" target="_blank" rel="noopener">VisualVM</a>,å½“ç„¶ä¸ºäº†èƒ½å¤Ÿè®©VisualVMèƒ½å¤Ÿè®¿é—®æœåŠ¡ç«¯çš„jvmè¿›ç¨‹ï¼Œæˆ‘ä»¬éœ€è¦å¯¹Solrè¿›è¡Œä¸€äº›é…ç½®ï¼Œè¿™ä¸ªæ¯”è¾ƒç®€å•ï¼Œä¸»è¦æ˜¯ä¿®æ”¹<strong>solr.in.sh</strong>æ–‡ä»¶çš„å†…å®¹ï¼Œç›´æ¥ä¸Šå…·ä½“çš„é…ç½®ç‚¹<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">SOLR_OPTS=<span class="string">"<span class="variable">$SOLR_OPTS</span> -Dcom.sun.management.jmxremote"</span></span><br><span class="line">SOLR_OPTS=<span class="string">"<span class="variable">$SOLR_OPTS</span> -Dcom.sun.management.jmxremote.port=28983"</span></span><br><span class="line">SOLR_OPTS=<span class="string">"<span class="variable">$SOLR_OPTS</span> -Dcom.sun.management.jmxremote.ssl=false"</span></span><br><span class="line">SOLR_OPTS=<span class="string">"<span class="variable">$SOLR_OPTS</span> -Dcom.sun.management.jmxremote.authenticate=false"</span></span><br><span class="line">SOLR_OPTS=<span class="string">"<span class="variable">$SOLR_OPTS</span> -Djava.rmi.server.hostname=192.168.18.2"</span></span><br></pre></td></tr></table></figure></p><p>é‡æ–°å¼€å¯æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯è¿›è¡Œå‹åŠ›æµ‹è¯•ï¼ˆä¹‹å‰çš„æ•°æ®å·²ç»æ¸…ç†æ‰äº†ï¼‰ï¼Œåœ¨ç¨‹åºè¿è¡Œäº†å‡ åˆ†é’Ÿä¹‹åæˆ‘ä»¬å¯ä»¥é€šè¿‡VisualVMçš„CPU profileåŠŸèƒ½å‘ç°ï¼Œå¤§é‡çš„cpuæ—¶é—´è¢«æ¶ˆè€—åœ¨äº†<strong>com.ibm.icu.text.RuleBasedTransliterator.handlerTransliterate()</strong> æ–¹æ³•ä¸Šäº†,<br><img src="https://s2.ax1x.com/2019/07/21/eCeRVP.png" alt="VisualVM CPU Profile"><br>å›æƒ³äº†ä¸‹Solrçš„ä¸­çš„å­—æ®µçš„å®šäº†ä¸­æœ‰ä¸ª<strong>solr.ICUTransformFilterFactory</strong>filterï¼Œæ˜¾ç„¶å°±æ˜¯è¿™ä¸ªfilterè€—è´¹äº†å¤§é‡çš„cpuæ—¶é—´ï¼ˆçœ‹åŒ…åå’Œç±»å‹å°±èƒ½è”æƒ³åˆ°ï¼‰,ä¸ºäº†ç®€å•çš„éªŒè¯æ˜¯ä¸æ˜¯è¿™ä¸ªç±»å¯¼è‡´çš„é—®é¢˜ï¼Œæˆ‘ç®€å•çš„åšäº†ä¸‹å¯¹æ¯”å®éªŒï¼Œæˆ‘å¯ä»¥æŠŠè¿™ä¸ªfilteræ³¨é‡Šæ‰çœ‹ä¸‹æœåŠ¡ç«¯çš„cpuä½¿ç”¨ç‡å’Œå®¢æˆ·ç«¯çš„ç´¢å¼•é€Ÿåº¦ã€‚ç›´æ¥ä¿®æ”¹schemaä¸­çš„field typeå®šä¹‰<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">fieldType</span> <span class="attr">name</span>=<span class="string">"test"</span>  <span class="attr">class</span>=<span class="string">"solr.TextField"</span> &gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">analyzer</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">charFilter</span> <span class="attr">class</span>=<span class="string">"solr.HTMLStripCharFilterFactory"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">charFilter</span> <span class="attr">class</span>=<span class="string">"solr.MappingCharFilterFactory"</span> <span class="attr">mapping</span>=<span class="string">"mapping-ISOLatin1Accent.txt"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">tokenizer</span> <span class="attr">class</span>=<span class="string">"solr.StandardTokenizerFactory"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.CJKWidthFilterFactory"</span>/&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- &lt;filter class="solr.ICUTransformFilterFactory" id="Traditional-Simplified"/&gt; --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.LowerCaseFilterFactory"</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.CJKBigramFilterFactory"</span> <span class="attr">han</span>=<span class="string">"true"</span> <span class="attr">outputUnigrams</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">analyzer</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">fieldType</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p>ç„¶åé‡æ–°å¼€å¯æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯è¿›è¡Œå‹åŠ›æµ‹è¯•ï¼ˆä¹‹å‰çš„æ•°æ®å·²ç»æ¸…ç†æ‰äº†ï¼‰ï¼Œç›´æ¥ä¸Šcpuä½¿ç”¨ç‡å’Œç´¢å¼•é€Ÿåº¦ä¿¡æ¯<br><img src="https://s2.ax1x.com/2019/07/21/eCAuWj.png" alt="Solr Server CPU usage"><br>å¹¶ä¸”å®¢æˆ·ç«¯çš„ç´¢å¼•é€Ÿåº¦ä¹Ÿé£™åˆ°äº†<strong>900 doc/s</strong>ï¼Œå°¼ç›å‘çˆ¹çš„<strong>ICUTransformFilterFactory</strong>,æä¸ªç®€ç¹è½¬æ¢è¿˜èƒ½æå‡ºä¸ªå¹ºè›¾å­ï¼Œå†çœ‹ä¸‹VisualVM  çš„cpu profileç»“æœ<br><img src="https://s2.ax1x.com/2019/07/21/eCenH0.png" alt="VisualVM CPU Profile"><br>ç—‡çŠ¶100%æ¶ˆå¤±,æ›´åŠ è‚¯å®šå°±æ˜¯<strong>ICUTransformFilterFactory</strong>æå‡ºæ¥çš„å¹ºè›¾å­ï¼Œæ€ä¹ˆå¼„ä¸ªç®€ç¹è½¬æ¢è¿˜èƒ½å‡ºè¿™ç§é—®é¢˜ï¼Œå¼±çˆ†äº†ã€‚ã€‚ã€‚</p><h2 id="æºç åˆ†æ"><a href="#æºç åˆ†æ" class="headerlink" title="æºç åˆ†æ"></a><font color="#2C3E50">æºç åˆ†æ</font></h2><p>ä¸ºäº†100%ç¡®è®¤çœŸçš„æ˜¯<strong>ICUTransformFilterFactory</strong>å¯¼è‡´çš„é—®é¢˜ï¼Œæˆ‘ä¸‹è½½äº†Solr-7.7.2çš„æºä»£ç ï¼Œå¹¶ä¸”è¿›è¡Œäº†æºç çš„debugï¼Œ<br>æœ€ç»ˆåœ¨<strong>com.ibm.icu.text.RuleBasedTransliterator.handlerTransliterate()</strong>ä¸­æ‰¾åˆ°çš„çœŸæ­£çš„é—®é¢˜æ‰€åœ¨ï¼ŒåºŸè¯ä¸è¯´ä¸Šä»£ç <br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Deprecated</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">handleTransliterate</span><span class="params">(Replaceable text, Position index, <span class="keyword">boolean</span> incremental)</span> </span>&#123;</span><br><span class="line">        RuleBasedTransliterator.Data var4 = <span class="keyword">this</span>.data;</span><br><span class="line">        <span class="keyword">synchronized</span>(<span class="keyword">this</span>.data) &#123;</span><br><span class="line">            <span class="keyword">int</span> loopCount = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">int</span> loopLimit = index.limit - index.start &lt;&lt; <span class="number">4</span>;</span><br><span class="line">            <span class="keyword">if</span>(loopLimit &lt; <span class="number">0</span>) &#123;</span><br><span class="line">                loopLimit = <span class="number">2147483647</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">while</span>(index.start &lt; index.limit &amp;&amp; loopCount &lt;= loopLimit &amp;&amp; <span class="keyword">this</span>.data.ruleSet.transliterate(text, index, incremental)) &#123;</span><br><span class="line">                ++loopCount;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p><p>å¯è§çœ‹è§å¤§å¤§çš„<strong>synchronized</strong>å…³é”®å­—ï¼Œéš¾æ€ªå˜›ï¼ŒSolrçš„ç´¢å¼•æ˜¯å¤šçº¿ç¨‹çš„ï¼Œå¹¶ä¸”åœ¨çœ‹äº†ICUçš„ä¸€äº›åˆå§‹åŒ–è¿‡ç¨‹ä¹‹åï¼Œåœ¨ç®€ç¹è½¬æ¢è¿™ä¸ªcaseä¸Šçš„RuleBasedTransliterator.Dataåªç”¨åˆå§‹åŒ–ä¸€æ¬¡å°±å¥½ï¼Œï¼ˆå…·ä½“çš„è¿‡ç¨‹æ¯”è¾ƒå¤æ‚ï¼Œç®€å•çš„æ¥è¯´è¿™ä¸­ç®€ç¹è½¬æ¢çš„ruleæ¥è‡ªäºé…ç½®æ–‡ä»¶ï¼Œæ˜¾ç„¶é…ç½®æ–‡ä»¶ä¸å¯èƒ½åŠ è½½å¤šæ¬¡ï¼‰ï¼Œæ‰€ä»¥ä¸€æ—¦ä¸Šäº†å¤šçº¿ç¨‹å°±å„ç§å¡ï¼Œcpuå…¨æ¶ˆè€—åœ¨å†…æ–—ä¸Šäº†ï¼Œå“ã€‚ã€‚ã€‚ã€‚ï¼Œä¸è¿‡å¥½æ¶ˆæ¯æ˜¯è¿™ä¸ª<strong>RuleBasedTransliterator</strong>ç±»å·²ç»è¢«æ‰“ä¸Šäº†<strong>Deprecated</strong>æ ‡ç­¾äº†ï¼Œæ‰€ä»¥ä¼°è®¡åœ¨é«˜ç‰ˆæœ¬çš„icu apiä¸­è¿™ä¸ªé—®é¢˜ä¼šä¸å¤å­˜åœ¨ã€‚</p><h2 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a><font color="#2C3E50">è§£å†³æ–¹æ¡ˆ</font></h2><p>æœ€ç®€å•çš„è§£å†³æ–¹æ¡ˆå°±æ˜¯ç­‰â€”&gt; ç­‰å®˜æ–¹å¹²æ‰è¿™ä¸ªç±»ï¼Œè¿™æ ·æœŸå¾…åœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­icuä¸å†ä½¿ç”¨è¿™ä¸ªå‘çˆ¹çš„<strong>synchronized</strong>å…³é”®å­—ï¼Œå½“ç„¶è¿™æ˜¾ç„¶ä¸æ˜¯æœ€å¥½çš„ç‰ˆæœ¬ï¼Œå½“ç„¶è¿˜æœ‰ä¸€ç§ç›¸å¯¹ç®€å•çš„æ–¹æ¡ˆå°±æ˜¯ç›´æ¥å¹²æ‰<strong>synchronized</strong>å…³é”®å­—ï¼Œç„¶åé‡æ–°ç¼–è¯‘æ‰“åŒ…ä¸€ä¸‹å°±å¥½ï¼Œå¦‚æœåªæ˜¯ä¸ºäº†å†™è¿™ç¯‡åšå®¢ç¡®å®å¯ä»¥è¿™ä¹ˆå¹²ï¼Œå› ä¸ºåæœŸçš„ç»´æŠ¤æˆæœ¬ä¸º0ï¼Œä½†æ˜¯åœ¨çœŸæ˜¯çš„ä¼ä¸šå¼€å‘ä¸­è¿˜æ˜¯ä¸å¤ªå¯å–çš„ï¼Œå¦‚æœsolrä»Šåç‰ˆæœ¬å‡çº§ï¼Œæˆ‘ä»¬ä¹Ÿè¦ä¸‹è½½å¯¹åº”çš„icuåŒ…ç„¶åå»æ‰<strong>synchronized</strong>å…³é”®å­—ï¼Œç„¶ååœ¨é‡æ–°ç¼–è¯‘æ‰“åŒ…ç­‰æ“ä½œï¼Œè™½ç„¶è¯´æ˜¯ä¸€æ¬¡æ€§å·¥ä½œï¼Œä½†æ˜¯ç›¸å½“äºæˆ‘ä»¬é—´æ¥çš„åœ¨ç»´æŠ¤icuçš„æºç äº†ã€‚<br>è¿˜æœ‰ä¸€ç§æœ€æš´åŠ›çš„åšæ³•ï¼Œä½†æ˜¯å´æ˜¯æˆ‘æ¯”è¾ƒæ¨èçš„åšæ³•ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªå·±é€ ä¸€ä¸ªç®€ç¹è½¬æ¢çš„solrpluginï¼Œç¡®å®ï¼Œåªæ˜¯ç®€å•çš„ç®€ä½“ä¸­æ–‡åˆ°ç¹ä½“ä¸­æ–‡çš„è½¬æ¢ï¼Œæˆ‘ä»¬åªéœ€è¦æ‰¾åˆ°ç®€ç¹çš„å¯¹ç…§è¡¨å°±å¯ä»¥åšäº†ã€‚è¯´å¹²å°±å¹²ï¼Œæˆ‘ç›´æ¥æå–äº†icuåŒ…ä¸­çš„ç®€ä½“ä¸­æ–‡å’Œç¹ä½“ä¸­æ–‡çš„å¯¹ç…§è¡¨ï¼ˆå½“ç„¶è·å–é€”å¾„æœ‰å¤šç§ï¼Œç”šè‡³wikiä¸Šéƒ½æœ‰ï¼‰ï¼Œè¿™é‡Œæ˜¯æˆ‘æå–çš„<a href="https://github.com/fengqingleiyue/apache-solr-plugins/blob/master/zh-converter/src/main/resources/hant_hans.properties" target="_blank" rel="noopener">ç®€ä½“ç¹ä½“å¯¹ç…§è¡¨</a>,æœ‰äº†ç®€ç¹è½¬æ¢è¡¨ï¼Œé‚£ä¹ˆsolrpluginä¹Ÿå°±ç›¸å¯¹ç®€å•äº†ï¼Œä¸å¤šè¯´ï¼Œç›´æ¥ä¸Š<a href="https://github.com/fengqingleiyue/apache-solr-plugins/tree/master/zh-converter" target="_blank" rel="noopener">ä»£ç </a>,ä¸ºäº†éªŒè¯é—®é¢˜æ˜¯å¦è§£å†³ï¼Œæˆ‘ç®€å•åšäº†ä¸‹å¯¹æ¯”æµ‹è¯•ï¼Œç´¢å¼•é€Ÿåº¦ç›´æ¥ä»åŸæ¥çš„<strong>401/s</strong>ä¸Šå‡åˆ°äº†<strong>936/s</strong> ,æœåŠ¡ç«¯çš„cpuä½¿ç”¨ç‡ä¹Ÿèƒ½å¤Ÿé£™å‡è‡³<strong>90%</strong>å·¦å³ï¼Œç›´æ¥ä¸Šå›¾<img src="https://s2.ax1x.com/2019/08/18/mlPsMT.png" alt="Solr Server CPU Usage">è‡³æ­¤icuå¯¼è‡´çš„æ€§èƒ½é—®é¢˜ï¼Œå·²ç»å¾—åˆ°è§£å†³ã€‚</p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;IBM-ICU-ç®€ç¹è½¬æ¢å·¥å…·çš„æ€§èƒ½å‘&quot;&gt;&lt;a href=&quot;#IBM-ICU-ç®€ç¹è½¬æ¢å·¥å…·çš„æ€§èƒ½å‘&quot; class=&quot;headerlink&quot; title=&quot;IBM ICU ç®€ç¹è½¬æ¢å·¥å…·çš„æ€§èƒ½å‘&quot;&gt;&lt;/a&gt;&lt;font color=&quot;#0077bb&quot;&gt;IBM ICU ç®€ç¹è½¬æ¢å·¥å…·çš„æ€§èƒ½å‘&lt;/font&gt;&lt;/h1&gt;&lt;h2 id=&quot;èƒŒæ™¯ä»‹ç»&quot;&gt;&lt;a href=&quot;#èƒŒæ™¯ä»‹ç»&quot; class=&quot;headerlink&quot; title=&quot;èƒŒæ™¯ä»‹ç»&quot;&gt;&lt;/a&gt;&lt;font color=&quot;#2C3E50&quot;&gt;èƒŒæ™¯ä»‹ç»&lt;/font&gt;&lt;/h2&gt;&lt;p&gt;ç”±äºå·¥ä½œå†…å®¹çš„éœ€è¦ï¼Œæˆ‘ä»¬å¤„ç†çš„æ–‡æœ¬æ•°æ®ä¸­ä¼šæœ‰ç¹ä½“ä¸­æ–‡ï¼Œä½†æ˜¯æˆ‘ä»¬çš„äº§å“çš„ä½¿ç”¨å®¢æˆ·éƒ½æ˜¯ä¹ æƒ¯ä½¿ç”¨ç®€ä½“ä¸­æ–‡ï¼ˆå°æ¹¾æ˜¯ä¸­å›½ä¸å¯å‰²èˆçš„ä¸€éƒ¨åˆ†ï¼‰ï¼Œæ‰€ä»¥ä¸ºäº†æ–¹ä¾¿ç”¨æˆ·ä½¿ç”¨ç®€ä½“ä¸­æ–‡æ£€ç´¢åˆ°ç¹ä½“ä¸­æ–‡ï¼Œæˆ‘ä»¬éœ€è¦åœ¨å»ºç«‹ç´¢å¼•çš„æ—¶å€™ï¼ˆè¿™é‡Œä»¥solrä¸ºä¾‹å­ï¼‰è¿›è¡Œç®€ç¹è½¬æ¢ã€‚ç®€å•çš„æŸ¥çœ‹äº†Solrçš„æ–‡æ¡£ï¼Œä»¥åŠç®€å•çš„ç™¾åº¦æˆ–è€…Google, æˆ‘ä»¬å¯ä»¥åœ¨Solr(7.7.2)ä¸­æ·»åŠ ä»¥ä¸‹çš„å­—æ®µç±»å‹æ¥è¿›è¡Œä¸­æ–‡åˆ†è¯å’Œç®€ç¹è½¬æ¢ã€‚&lt;br&gt;&lt;figure class=&quot;highlight xml&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;fieldType&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;name&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;test&quot;&lt;/span&gt;  &lt;span class=&quot;attr&quot;&gt;class&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;solr.TextField&quot;&lt;/span&gt; &amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;analyzer&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;charFilter&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;class&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;solr.HTMLStripCharFilterFactory&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;charFilter&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;class&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;solr.MappingCharFilterFactory&quot;&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;mapping&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;mapping-ISOLatin1Accent.txt&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;tokenizer&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;class&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;solr.StandardTokenizerFactory&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;filter&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;class&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;solr.CJKWidthFilterFactory&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;filter&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;class&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;solr.ICUTransformFilterFactory&quot;&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;id&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;Traditional-Simplified&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;filter&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;class&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;solr.LowerCaseFilterFactory&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &lt;span class=&quot;tag&quot;&gt;&amp;lt;&lt;span class=&quot;name&quot;&gt;filter&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;class&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;solr.CJKBigramFilterFactory&quot;&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;han&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;true&quot;&lt;/span&gt; &lt;span class=&quot;attr&quot;&gt;outputUnigrams&lt;/span&gt;=&lt;span class=&quot;string&quot;&gt;&quot;true&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         &lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;analyzer&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;tag&quot;&gt;&amp;lt;/&lt;span class=&quot;name&quot;&gt;fieldType&lt;/span&gt;&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;å¯ä»¥çœ‹åˆ°è¿™æ˜¯æœ€ç®€å•çš„ä¸­æ–‡åˆ†è¯å™¨-&amp;gt; äºŒå…ƒåˆ†è¯ï¼Œå¹¶ä¸”åœ¨äºŒå…ƒçš„åŸºç¡€ä¸Šè¾“å‡ºäº†ä¸€å…ƒçš„ç»“æœï¼Œè¿™é‡Œå¯ä»¥ç®€å•çœ‹ä¸‹åˆ†è¯ç»“æœ&lt;br&gt;&lt;img src=&quot;https://s2.ax1x.com/2019/07/21/eCmvwt.png&quot; alt=&quot;äºŒå…ƒ+ä¸€å…ƒåˆ†è¯æ•ˆæœ&quot;&gt;&lt;br&gt;ä¼¼ä¹é…ç½®+ä½¿ç”¨èµ·æ¥ä¹Ÿå°±5s(666),ä½†æ˜¯å®é™…æƒ…å†µæ˜¯æ€§èƒ½ä¸å¤Ÿï¼Œå°„ä¸é«˜ï¼Œè·‘ä¸å¿«ã€‚&lt;br&gt;
    
    </summary>
    
    
      <category term="Solr" scheme="https://www.fengqinglei.top/tags/Solr/"/>
    
      <category term="IBM ICU" scheme="https://www.fengqinglei.top/tags/IBM-ICU/"/>
    
      <category term="Traditional-Simplified" scheme="https://www.fengqinglei.top/tags/Traditional-Simplified/"/>
    
      <category term="Performance" scheme="https://www.fengqinglei.top/tags/Performance/"/>
    
      <category term="æ€§èƒ½è°ƒä¼˜" scheme="https://www.fengqinglei.top/tags/%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98/"/>
    
  </entry>
  
  <entry>
    <title>å¦‚ä½•åŠ¨æ€è®¾ç½®Solr Payload</title>
    <link href="https://www.fengqinglei.top/2019/07/10/SolrPayLoads/"/>
    <id>https://www.fengqinglei.top/2019/07/10/SolrPayLoads/</id>
    <published>2019-07-10T15:05:22.000Z</published>
    <updated>2019-09-27T00:41:27.954Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å¦‚ä½•åŠ¨æ€è®¾ç½®Solr-Payload"><a href="#å¦‚ä½•åŠ¨æ€è®¾ç½®Solr-Payload" class="headerlink" title="å¦‚ä½•åŠ¨æ€è®¾ç½®Solr Payload "></a><font color="#0077bb">å¦‚ä½•åŠ¨æ€è®¾ç½®Solr Payload </font></h1><h2 id="é—®é¢˜èƒŒæ™¯"><a href="#é—®é¢˜èƒŒæ™¯" class="headerlink" title="é—®é¢˜èƒŒæ™¯"></a><font color="#2C3E50">é—®é¢˜èƒŒæ™¯</font></h2><p>Solr ä»6.xå¼€å§‹æä¾›äº†index payloadçš„åŠŸèƒ½ï¼Œï¼ˆpayloadæ˜¯æŒ‡å¯ä»¥æŒ‡å®šä¸ºåˆ†è¯ä¹‹åçš„æ¯ä¸ªtermæŒ‡å®šä¸€ä¸ªäºŒè¿›åˆ¶çš„ä¿¡æ¯ï¼Œç”¨äºé’ˆå¯¹æ¯ä¸ªtermä½œå‡ºä¸€å®šçš„è¡Œä¸ºï¼Œä¾‹å¦‚å¯ä»¥ç”¨æ¥å­˜å‚¨æŒ‡å®šçš„scoreç”¨äºæ’åºï¼Œä¹Ÿå¯ä»¥ç”¨æ¥å­˜å‚¨æŒ‡å®šçš„æ•°æ®ï¼Œç”¨äºæ£€æŸ¥termçš„ä¸€å®šçš„æ£€æŸ¥ï¼‰ï¼Œç®€å•çš„æŸ¥é˜…å®˜æ–¹æ–‡æ¡£ä¹‹åï¼ˆè¿™é‡Œä½¿ç”¨solr7.7.2ä½œä¸ºæ ·ä¾‹ï¼‰,å¾—çŸ¥æˆ‘ä»¬å¯ä»¥åŠ¨æ€çš„è®¾å®šæ¯ä¸ªtermçš„payloadï¼ˆå‚è€ƒ<a href="https://lucidworks.com/post/end-to-end-payload-example-in-solr/" target="_blank" rel="noopener">SolrPayload</a>ï¼‰ï¼Œä¹Ÿå¯ä»¥æ ¹æ®æŒ‡å®šçš„token typeè®¾ç½®payloadæ•°å€¼(å‚è€ƒ<a href="https://lucene.apache.org/solr/guide/7_4/filter-descriptions.html#numeric-payload-token-filter" target="_blank" rel="noopener">Numeric Payload Token Filter</a>)ï¼Œä½†æ˜¯ä¸Šè¿°ä¸¤ç§æ–¹å¼éƒ½æ— æ³•æ ¹æ®è¾“å…¥çš„å˜åŒ–è€ŒåŠ¨æ€çš„æ”¹å˜payloadçš„å€¼ã€‚<br><a id="more"></a></p><h3 id="å…·ä½“éœ€æ±‚"><a href="#å…·ä½“éœ€æ±‚" class="headerlink" title="å…·ä½“éœ€æ±‚"></a><font color="#2C3E50">å…·ä½“éœ€æ±‚</font></h3><p>ç”±äºå’Œå…·ä½“çš„çš„ä¸šåŠ¡æœ‰å…³ï¼Œæˆ‘è¿™é‡Œå°†éœ€æ±‚ç®€å•åŒ–ã€‚</p><blockquote><ul><li>ä¸šåŠ¡ä¸­çš„å­—æ®µç±»å‹ä¸ºå¤šå€¼å­—æ®µ</li><li>åŒä¸€ç¯‡æ–‡æ¡£çš„å¤šå€¼å­—æ®µä¸­ä¸åŒçš„æ•°å€¼éœ€è¦è®¾ç½®ä¸åŒçš„payload</li><li>éœ€è¦æ›´å…·ä¸åŒçš„å‚æ•°è®¾å®šä¸åŒçš„payloadæ•°å€¼</li></ul></blockquote><p>çœ‹åˆ°è¿™é‡Œè€å¸æœºè‚¯å®šè¯´è¿™ä¸ªéœ€æ±‚å¤ªç®€å•äº†ï¼Œç›´æ¥ä½¿ç”¨<strong>Numeric Payload Token Filter</strong> å°±è¡Œäº†ï¼Œå¯ä»¥å°†å¤šå€¼å­—æ®µæ”¾åˆ°å¤šä¸ªå­—æ®µä¸­ï¼Œæ¯ä¸ªå­—æ®µæŒ‡å®šä¸åŒçš„payloadçš„é—®é¢˜ä¹Ÿå¯ä»¥è§£å†³å•Š (åªéœ€è¦æŒ‡å®šä¸åŒå­—æ®µç±»å‹ä¸‹é¢ä¾‹å­ä¸­çš„payloadå€¼å°±è¡Œäº†)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;analyzer&gt;</span><br><span class="line">  &lt;tokenizer class=&quot;solr.WhitespaceTokenizerFactory&quot;/&gt;</span><br><span class="line">  &lt;filter class=&quot;solr.NumericPayloadTokenFilterFactory&quot; payload=&quot;0.75&quot; typeMatch=&quot;word&quot;/&gt;</span><br><span class="line">&lt;/analyzer&gt;</span><br></pre></td></tr></table></figure></p><p>ç¡®å®ï¼Œåœ¨å¤šå€¼å­—æ®µçš„å€¼çš„ä¸ªæ•°è¾ƒå°‘çš„æ—¶å€™æˆ‘ä¹Ÿæ¨èè¿™ç§åšæ³•ï¼Œå› ä¸ºç›¸å¯¹æ¯”è¾ƒç®€å•ï¼Œè€Œä¸”å®¹æ˜“æ“ä½œã€‚ä½†æ˜¯å¦‚æœæˆ‘æœ‰å¤šå€¼å­—æ®µæœ‰20ä¸ªå€¼ï¼Œé‚£ä¹ˆè¿™æ ·æˆ‘çš„schemaé‡Œé¢å¿…é¡»å¾—æœ‰20ä¸ªå­—æ®µç±»å‹ï¼Œ20ä¸ªå­—æ®µæ¥å¯¹åº”çš„å¤šä¸ªpayload ,é‚£ä¹ˆç®¡ç†è¿™20ä¸ªå­—æ®µå°±å˜æˆäº†ä¸€ä»¶è›‹ç–¼çš„äº‹æƒ…ã€‚<br>å½“ç„¶è¿™é‡Œä¹Ÿæœ‰äººä¼šè¯´ä¸ºå•¥ä¸ç”¨solrçš„<strong>DelimitedPayloadTokenFilter</strong>(<a href="https://lucidworks.com/post/solr-payloads/ï¼‰" target="_blank" rel="noopener">ç”¨æ³•å¯ä»¥å‚è€ƒ</a>,æˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨æŒ‡å®šæ¯ä¸ªtermçš„payloadï¼Œä¾‹å¦‚ (åˆ†éš”ç¬¦|åé¢çš„æ•°å­—ä¸ºpayload)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">id,vals_dpf</span><br><span class="line">1,one|1.0 two|2.0 three|3.0</span><br><span class="line">2,weighted|50.0 weighted|100.0</span><br></pre></td></tr></table></figure></p><p>æ˜¯çš„ï¼Œç¡®å®å¯ä»¥ï¼Œä½†æ˜¯å‰ææ˜¯ä½ çš„æ–‡æ¡£å†…å®¹æ¯”è¾ƒç®€å•ï¼ˆå†…å®¹ç®€å•çš„è¯æ¨èä½¿ç”¨<strong>DelimitedPayloadTokenFilter</strong>,å¯ä»¥åœ¨indexä»£ç ä¸­æ ¹æ®ä¸šåŠ¡åŠ¨æ€æ§åˆ¶ï¼‰ï¼Œå¦‚æœæ–‡æ¡£æ¯”è¾ƒå¤æ‚ï¼Œæ¯”å¦‚å°±æ˜¯ä¸€æ®µæ–‡æœ¬ï¼Œé‚£ä¹ˆç›¸å½“äºä½ å¾—åœ¨indexä»£ç ä¸­å°†æ–‡æœ¬è¿›è¡Œåˆ†è¯ç„¶åæ‹¼æ¥æˆä¸Šè¿°çš„ä¾‹å­ï¼Œä½†æ˜¯å¦‚æœæ‹¼æ¥çš„è¯solrçš„åˆ†è¯åŠŸèƒ½å°±å½¢åŒæ‘†è®¾äº†ï¼Œé‚£ä¹ˆæœ‰æ²¡æœ‰åŠæ³•æ—¢èƒ½ä¿æŒindexä»£ç çš„ç®€å•æ€§ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨solrçš„åˆ†è¯åŠŸèƒ½æ¥å®Œæˆä¸Šè¿°çš„éœ€æ±‚å‘¢ï¼Ÿ</p><h2 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a><font color="#2C3E50">è§£å†³æ–¹æ¡ˆ</font></h2><p>è§£å†³æ–¹æ¡ˆå…¶å®åªæœ‰ä¸¤æ­¥</p><blockquote><ul><li>å¯ä»¥åŠ¨æ€çš„è®¾ç½®æŸä¸ªå­—æ®µçš„æŸä¸ªå€¼çš„æŸä¸ªå±æ€§</li><li>è‡ªå®šTokenizeræˆ–è€…filteræ ¹æ®æŸä¸ªå±æ€§è®¾å®šå¯¹ç”¨çš„payload</li></ul></blockquote><p>(æˆ‘å»ï¼Œè¿™ç®€ç›´å°±æ˜¯æ­£ç¡®çš„åºŸè¯)<br>é‚£ä¹ˆæ—¢ç„¶æˆ‘ä»¬çš„â€œè§£å†³æ–¹æ¡ˆâ€å·²ç»æœ‰äº†ï¼Œæˆ‘ä»¬è¯¥æ€ä¹ˆä¸€æ­¥æ­¥çš„å®ç°è¿™ä¸ªâ€œè§£å†³æ–¹æ¡ˆå‘¢â€ï¼Œæˆ‘ä»¬æ¥ä¸€æ­¥æ­¥åˆ†æä¸‹ï¼Œ</p><blockquote><ul><li>æˆ‘ä»¬æ€ä¹ˆåŠ¨æ€çš„è®¾ç½®æŸä¸ªå­—æ®µçš„æŸä¸ªå€¼çš„æŸä¸ªå±æ€§ï¼Ÿ</li></ul></blockquote><p>ç”±äºåœ¨indexçš„ä»£ç ä¸­ï¼ŒSolrçš„ç»™æˆ‘ä»¬çš„APIæ¯”è¾ƒç®€å•ï¼Œç›´æ¥å°±æ˜¯ SolrInputDocument.set(fieldname,fieldvalue),æˆ‘ä»¬èƒ½æ§åˆ¶çš„è¦ä¹ˆå°±æ˜¯fieldnameï¼Œè¦ä¹ˆå°±æ˜¯fieldvalueï¼Œ æ§åˆ¶fieldnameçš„æ–¹æ¡ˆæˆ‘å‰é¢å·²ç»ä»‹ç»è¿‡,å¯ä»¥ä½¿ç”¨<strong>Numeric Payload Token Filter</strong> æ¥è§£å†³æˆ‘ä»¬çš„é—®é¢˜ï¼Œè¿™é‡Œæˆ‘ä»¬å¯èƒ½è®¾æ³•åœ¨fieldnameä¸Šåšæ–‡ç« äº†ï¼Œé‚£ä¹ˆå¯ä»¥é€‰æ‹©çš„æ–¹æ¡ˆåªèƒ½æ˜¯åœ¨fieldvalueä¸Šä¸‹åŠŸå¤«äº†ï¼Œæ˜¾ç„¶ï¼Œæˆ‘ä»¬åªèƒ½åœ¨fieldvalueçš„å¤´ä¸ŠåŠ ä¸€äº›ç‰¹æ®Šçš„æ ‡è®°æ¥è§£å†³é—®é¢˜ï¼Œå½“ç„¶è¿™äº›ç‰¹æ®Šçš„æ ‡è®°ä¸èƒ½å’Œä½ çš„å­—æ®µå€¼çš„æŸä¸ªæˆ–è€…æŸäº›ç‰¹å¾å‘ç”Ÿå†²çªï¼Œä¾‹å¦‚æˆ‘ä»¬å¯ä»¥åœ¨å­—æ®µå€¼çš„å‰æ®µåŠ ä¸Šâ€[|xxx|]â€,é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥åœ¨æ›´å…·xxxçš„å†…å®¹è®¾å®šæŸä¸ªå­—æ®µçš„æŸä¸ªå±æ€§å°±è¡Œäº†</p><blockquote><ul><li>å¦‚ä½•åœ¨solrç«¯è¯»å–xxxçš„å†…å®¹ï¼Ÿ</li></ul></blockquote><p>solrçš„indexåŠŸèƒ½æ˜¯åŸºäºLuceneæä¾›çš„ï¼Œé‚£ä¹ˆLuceneç»™æˆ‘çš„apiä¹Ÿæ¯”è¾ƒç®€å•<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Document doc = new Document();</span><br><span class="line">doc.add(new StringField(&quot;fieldName&quot;,&quot;document context&quot;, Field.Store.YES));</span><br></pre></td></tr></table></figure></p><p>ä¹Ÿå°±æ˜¯æ‰€æœ‰çš„æ–‡æ¡£çš„å­—æ®µåˆ°luceneè¿™ä¸€å±‚è‚¯å®šéƒ½æ˜¯è½¬æˆä¸€ä¸ªdocumentï¼Œç„¶åå‘æ–‡æ¡£é‡Œé¢æ·»åŠ å¯¹åº”çš„å­—æ®µï¼Œä¸åŒçš„å­—æ®µä½¿ç”¨ä¸åŒçš„åˆ†è¯å™¨æ¥è¿›è¡Œåˆ†è¯ï¼Œå¯¹ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰å­—æ®µï¼Œåœ¨ç”Ÿæˆè¿™ä¸ªå­—æ®µçš„æ—¶å€™è§£æ<strong>xxx</strong>çš„å†…å®¹ï¼Œå¹¶ä¸”æ ¹æ®<strong>xxx</strong>çš„å†…å®¹è®¾å®šæŸä¸ªå±æ€§çš„å€¼é—®é¢˜ä¸å°±èƒ½è§£å†³äº†å—ï¼Ÿ<br>ç®€å•çš„ç¿»çœ‹äº†Solrçš„æŸä¸ªå­—æ®µç±»å‹çš„æºç ï¼ˆè¿™é‡Œä»¥<strong>Solr.TextField</strong>ä¸ºä¾‹å­ï¼‰<br><img src="https://s2.ax1x.com/2019/07/21/epDlO1.png" alt="Solr.TextField Method List"> ,éƒ½æ˜¯ä¸€äº›getæ–¹æ³•ï¼Œè²Œä¼¼æ²¡å•¥ç”¨ï¼Œçœ‹çœ‹çˆ¶ç±»<strong>org.apache.solr.schema.FieldType</strong><br><img src="https://s2.ax1x.com/2019/07/21/epDVoT.png" alt="FieldType Method List"><br>è²Œä¼¼<strong>createField</strong>å°±æ˜¯æˆ‘ä»¬è¦æ‰¾çš„æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¿™é‡Œè§£æfieldvalue ,å¹¶ä¸”æ ¹æ®<strong>xxx</strong>è®¾ç½®è¿™ä¸ªå­—æ®µçš„æŸä¸ªå±æ€§ï¼Œç„¶åæ‹¿æ‰<strong>xxx</strong>,è¿˜åŸåŸå§‹çš„fieldvalue</p><blockquote><ul><li>â€œæŸä¸ªå±æ€§â€åˆ°åº•æ˜¯å“ªä¸ªå±æ€§</li></ul></blockquote><p>åœ¨ä¸Šæ–‡ä¸­æˆ‘ä»¬ä¸€ç›´æåˆ°â€œæŸä¸ªå±æ€§â€ï¼Œä½†æ˜¯æˆ‘ä»¬åˆ°ç›®å‰ä¸ºæ­¢è¿˜æ˜¯æ²¡æœ‰æ‰¾åˆ°è¿™ä¸ªå¯ä»¥è®¾ç½®çš„å±æ€§åˆ°åº•æ˜¯å•¥ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬ä¸æ‰¾åˆ°è¿™ä¸ªå±æ€§ï¼Œä¸Šé¢çš„åˆ†æè¿‡ç¨‹å…¨æ˜¯æ‰¯æ·¡çš„ï¼Œä¸ºäº†æ‰¾åˆ°è¿™ä¸ªå±æ€§ï¼Œæˆ‘ä»¬å¿…é¡»çŸ¥é“è¿™ä¸ªå±æ€§æ»¡è¶³ä»€ä¹ˆæ ·çš„ç‰¹å¾å‘¢ï¼Œæˆ‘ä»¬åˆ†æä¸‹è¿™ä¸ªå±æ€§éœ€è¦æ»¡è¶³çš„ç‰¹å¾</p><blockquote><blockquote><ul><li>è¿™ä¸ªå±æ€§ä¸èƒ½å¯¹åŸå§‹çš„fieldvalueäº§ç”Ÿå˜æ›´</li></ul></blockquote></blockquote><p>ä¸ºä»€ä¹ˆï¼ŸæŒ‰ç…§æˆ‘ä»¬çš„æƒ³æ³•ï¼Œè¿™ä¸ªâ€æŸä¸ªå±æ€§â€œä¸èƒ½å¯¹åŸå§‹çš„fieldvalueå‚æ•°å½±å“ï¼Œå¦‚æœæ”¹å˜äº†åŸå§‹valueï¼Œ</p><blockquote><blockquote><ul><li>è¿™ä¸ªå±æ€§å¯ä»¥å¿…é¡»æ˜¯è·Ÿç€termèµ°çš„ï¼Œå¹¶ä¸”å¯ä»¥åœ¨tokenizerå’Œfilterä¸­å¯ä»¥è·å–</li></ul></blockquote></blockquote><p>ä¸ºä»€ä¹ˆï¼ŸæŒ‰ç…§æˆ‘ä»¬çš„åšæ³•ï¼Œæˆ‘ä»¬å¿…é¡»åœ¨æŸä¸ªtokenizeræˆ–è€…filteræˆ–è€…è¿™ä¸ªå±æ€§ï¼Œæ‰èƒ½è®¾ç½®payloadçš„å€¼ï¼Œå…¶ä»–çš„åœ°æ–¹æ²¡å‘æ¥è§¦åˆ°payload </p><p>æ˜ç¡®äº†ä¸Šè¿°ä¸¤ä¸ªç‰¹å¾ï¼Œæˆ‘ä»¬æ‰¾ä¸ªfilterï¼tokenizerçš„æºä»£ç çœ‹ä¸‹ ,æ‰¾ä¸ªæœ€ç®€å•çš„<strong>LowerCaseFilter</strong> çœ‹çœ‹<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LowerCaseFilter</span> <span class="keyword">extends</span> <span class="title">TokenFilter</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> CharTermAttribute termAtt = addAttribute(CharTermAttribute.class);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Create a new LowerCaseFilter, that normalizes token text to lower case.</span></span><br><span class="line"><span class="comment">   * </span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> in TokenStream to filter</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">LowerCaseFilter</span><span class="params">(TokenStream in)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>(in);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">incrementToken</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (input.incrementToken()) &#123;</span><br><span class="line">      CharacterUtils.toLowerCase(termAtt.buffer(), <span class="number">0</span>, termAtt.length());</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>çœ‹åˆ°è¿™é‡Œæˆ‘ä»¬æœ‰äº†ç­”æ¡ˆï¼ŒåŸæ¥CharTermAttributeå°±æ˜¯Luceneï¼SolråŸæ¥åœ¨è®¾å®šæŸä¸ªtermçš„å€¼çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥è‡ªå·±é€ ä¸€ä¸ªï¼Œæ”¾å…¥æ ¹æ®<strong>xxx</strong>å¾—åˆ°çš„å±æ€§ï¼Œç„¶ååœ¨filteré‡Œé¢æˆ–è€…è¿™ä¸ªå±æ€§ï¼Œä¸å°±å¯ä»¥åŠ¨æ€çš„è®¾å®špayloadçš„å€¼äº†å˜›ï¼Œ å¯¹å¤´ï¼Œ ä¸Šä»£ç  </p><blockquote><ul><li>è‡ªå®šä¹‰Solrçš„Field </li></ul></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DynamicPayloadsField</span> <span class="keyword">extends</span> <span class="title">TextField</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger log = LoggerFactory.getLogger(MethodHandles.lookup().lookupClass());</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> IndexableField <span class="title">createField</span><span class="params">(SchemaField field, Object value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!field.indexed() &amp;&amp; !field.stored()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (log.isTraceEnabled())</span><br><span class="line">                log.trace(<span class="string">"Ignoring unindexed/unstored field: "</span> + field);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        String val;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            val = toInternal(value.toString());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (RuntimeException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> SolrException( SolrException.ErrorCode.SERVER_ERROR, <span class="string">"Error while creating field '"</span> + field + <span class="string">"' from value '"</span> + value + <span class="string">"'"</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (val==<span class="keyword">null</span>) <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        String target = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">if</span> (val.startsWith(<span class="string">"[|"</span>) &amp;&amp; val.contains(<span class="string">"|]"</span>)) &#123;</span><br><span class="line">            target = val.substring(<span class="number">2</span>,val.indexOf(<span class="string">"|]"</span>));</span><br><span class="line">            <span class="keyword">if</span> (DynamicPayloadAttribute.FIELD_MAPPINGS.containsKey(target)) &#123;</span><br><span class="line">                String parsedData = val.substring(val.indexOf(<span class="string">"|]"</span>)+<span class="number">2</span>);</span><br><span class="line">                TokenizerChain tokenizerChain = (TokenizerChain)field.getType().getIndexAnalyzer();</span><br><span class="line">                Tokenizer tk = tokenizerChain.getTokenizerFactory().create(TokenStream.DEFAULT_TOKEN_ATTRIBUTE_FACTORY);</span><br><span class="line">                TokenStream ts = tk;</span><br><span class="line">                <span class="keyword">for</span> (TokenFilterFactory filter : tokenizerChain.getTokenFilterFactories()) &#123;</span><br><span class="line">                    ts = filter.create(ts);</span><br><span class="line">                &#125;</span><br><span class="line">                Analyzer.TokenStreamComponents components = <span class="keyword">new</span> Analyzer.TokenStreamComponents(tk, ts);</span><br><span class="line">                Reader stringReader = tokenizerChain.initReader(field.getName(),<span class="keyword">new</span> StringReader(parsedData));</span><br><span class="line">                tk.setReader(stringReader);</span><br><span class="line">                TokenStream stream = components.getTokenStream();</span><br><span class="line">                stream.getAttribute(DynamicPayloadAttribute.class).setPayloadType(target);</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> Field(field.getName(), stream, field);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">super</span>.createField(field.getName(), val, field);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">super</span>.createField(field.getName(), val, field);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><ul><li>è‡ªå®šä¹‰Attribute</li></ul></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">DynamicPayloadAttribute</span> <span class="keyword">extends</span> <span class="title">Attribute</span> </span>&#123;</span><br><span class="line">    Map&lt;String,Integer&gt; FIELD_MAPPINGS = <span class="keyword">new</span> HashMap&lt;String,Integer&gt;()&#123;</span><br><span class="line">        &#123;</span><br><span class="line">            put(<span class="string">"A"</span>,<span class="number">0</span>);</span><br><span class="line">            put(<span class="string">"B"</span>,<span class="number">1</span>);</span><br><span class="line">            put(<span class="string">"C"</span>,<span class="number">2</span>);</span><br><span class="line">            put(<span class="string">"D"</span>,<span class="number">3</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    String DEFAULT_PAYLOAD_TYPE = <span class="string">"UNKNOW_PAYLOAD_TYPE"</span>;</span><br><span class="line">    <span class="function">String <span class="title">payloadType</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setPayloadType</span><span class="params">(String type)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">byte</span> <span class="title">getPayLoad</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><ul><li>è‡ªå®šä¹‰filter</li></ul></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DynamicPayloadTokenFilter</span> <span class="keyword">extends</span> <span class="title">TokenFilter</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> PayloadAttribute payAtt = addAttribute(PayloadAttribute.class);</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> DynamicPayloadAttribute dypayAtt = addAttribute(DynamicPayloadAttribute.class);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="title">DynamicPayloadTokenFilter</span><span class="params">(TokenStream input)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(input);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">incrementToken</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (input.incrementToken()) &#123;</span><br><span class="line">            <span class="keyword">byte</span> payload = dypayAtt.getPayLoad();</span><br><span class="line">            <span class="keyword">if</span>(payload==Byte.MAX_VALUE)&#123;</span><br><span class="line">                payAtt.setPayload(<span class="keyword">null</span>);</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">byte</span> array [] = &#123;payload&#125;;</span><br><span class="line">                payAtt.setPayload(<span class="keyword">new</span> BytesRef(array));</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæˆ‘åªæ”¾ä¸Šäº†é‡è¦çš„ä»£ç ç‰‡æ®µï¼Œå®Œæ•´çš„ä»£ç è¯·å‚è€ƒ<a href="https://github.com/fengqingleiyue/apache-solr-plugins/tree/master/dynamic-payload" target="_blank" rel="noopener">apache-solr-plugins/dynamic-payload</a></p><h2 id="çˆ¬å‘æŒ‡å—"><a href="#çˆ¬å‘æŒ‡å—" class="headerlink" title="çˆ¬å‘æŒ‡å—"></a><font color="#2C3E50">çˆ¬å‘æŒ‡å—</font></h2><p>å½“ç„¶å¦‚æœæ‰€æœ‰çš„ç»†èŠ‚éƒ½å¦‚ä¸Šè¿°æè¿°é‚£ä¹ˆç®€å•ï¼Œé‚£ä¹ˆå„ä½çœ‹å®˜è‚¯å®šè§‰å¾—æ— èŠæ­»äº†ï¼Œæ‰€æœ‰çš„ç¨‹åºå‘˜æœ‹å‹ä»¬è‚¯å®šæ›´åŠ å…³æ³¨è¿™ä¸ªè¿‡ç¨‹ä¸­æœ‰æ²¡æœ‰ä»€ä¹ˆå‘ï¼Œå½“ç„¶å‘æ˜¯å­˜åœ¨çš„ï¼Œå‘æ˜¯ç—›è‹¦çš„ï¼Œçˆ¬å‘çš„è¿‡ç¨‹æ˜¯ç—›è‹¦çš„ï¼Œçˆ¬å‘æ˜¯éœ€è¦åˆ†äº«çš„ã€‚<br>é‡åˆ°çš„å‘:<br>åœ¨Solrçš„<a href="http://127.0.0.1:8983/solr/#/TEST/documents" target="_blank" rel="noopener">document</a>é¡µé¢ä¸Šæ·»åŠ æ–‡æ¡£æ˜¯æˆåŠŸçš„ï¼Œä½†æ˜¯ä¸€æ—¦ç”¨ä»£ç ä¸Šå¤šçº¿ç¨‹ç«‹é©¬æŠ¥é”™ï¼ˆä¸»è¦çš„é”™è¯¯å°±æ˜¯TokenStream åœ¨è°ƒç”¨å‰æ²¡æœ‰è°ƒç”¨resetæ–¹æ³•ï¼‰<br>åœ¨æ²¡æœ‰ä¿®æ­£è¿™ä¸ªé—®é¢˜ä¹‹å‰çš„<strong>createField</strong>çš„æ–¹æ³•å®ç°ä¸ºï¼ˆéƒ¨åˆ†ï¼‰<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (val.startsWith(<span class="string">"[|"</span>) &amp;&amp; val.contains(<span class="string">"|]"</span>)) &#123;</span><br><span class="line">           target = val.substring(<span class="number">2</span>,val.indexOf(<span class="string">"|]"</span>));</span><br><span class="line">           <span class="keyword">if</span> (DynamicPayloadAttribute.FIELD_MAPPINGS.containsKey(target)) &#123;</span><br><span class="line">               String parsedData = val.substring(val.indexOf(<span class="string">"|]"</span>)+<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">               TokenStream stream = field.getType().getIndexAnalyzer().tokenStream(field.getName(),parsedData);</span><br><span class="line">               stream.addAttributeImpl(<span class="keyword">new</span> DynamicPayloadAttributeImpl(target));</span><br><span class="line">               <span class="keyword">return</span> <span class="keyword">new</span> Field(field.getName(),stream,field);</span><br></pre></td></tr></table></figure></p><p>è€Œé—®é¢˜å°±å‡ºç°åœ¨tokenStreamæ–¹æ³•ä¸Š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">field.getType().getIndexAnalyzer().tokenStream(field.getName(),parsedData);</span><br></pre></td></tr></table></figure></p><p>è¿›å…¥å®ç°å¯ä»¥çœ‹åˆ°TokenStreamComponentsæ˜¯ä¼šé‡ç”¨çš„<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> TokenStream <span class="title">tokenStream</span><span class="params">(String fieldName, String text)</span> </span>&#123;</span><br><span class="line">        Analyzer.TokenStreamComponents components = <span class="keyword">this</span>.reuseStrategy.getReusableComponents(<span class="keyword">this</span>, fieldName);</span><br><span class="line">        ReusableStringReader strReader = components != <span class="keyword">null</span> &amp;&amp; components.reusableStringReader != <span class="keyword">null</span>?components.reusableStringReader:<span class="keyword">new</span> ReusableStringReader();</span><br><span class="line">        strReader.setValue(text);</span><br><span class="line">        Reader r = <span class="keyword">this</span>.initReader(fieldName, strReader);</span><br><span class="line">        <span class="keyword">if</span>(components == <span class="keyword">null</span>) &#123;</span><br><span class="line">            components = <span class="keyword">this</span>.createComponents(fieldName);</span><br><span class="line">            <span class="keyword">this</span>.reuseStrategy.setReusableComponents(<span class="keyword">this</span>, fieldName, components);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        components.setReader(r);</span><br><span class="line">        components.reusableStringReader = strReader;</span><br><span class="line">        <span class="keyword">return</span> components.getTokenStream();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p><p>è¿™æ ·åšçš„å¥½å¤„å°±æ˜¯ä¸ç”¨é‡å¤ç”Ÿæˆtokenstream compentsï¼Œå¹¶ä¸”ä¸åŒçš„åªæ˜¯è¾“å…¥ï¼Œå…¶ä»–çš„éƒ½æ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯ä¸ºå•¥åœ¨æˆ‘ä»¬çš„åº”ç”¨åœºæ™¯å°±ä¼šæŠ¥é”™å‘¢ï¼ŒåŸæ¥é”™è¯¯ä¸å†æˆ‘ä»¬çš„ä½¿ç”¨æ–¹å¼ä¸Šï¼Œè€Œæ˜¯åœ¨solrçš„åç»­çš„æµç¨‹ä¸­ä¼šè°ƒç”¨<strong>Field.tokenStream</strong>æ–¹æ³•ï¼Œå¹¶ä¸”åœ¨<strong>tokenStream</strong>å±æ€§ä¸ä¸ºç©ºçš„æƒ…å†µä¸‹ï¼Œå°±ä¼šç›´æ¥returnï¼Œæ‰€ä»¥æƒ³è±¡ä¸‹ï¼Œå¦‚æœåŒä¸€ä¸ªå­—æ®µçš„ä¸åŒå€¼å…¬ç”¨äº†åŒä¸€ä¸ªtokenstreamå±æ€§ï¼Œé‚£ä¹ˆé’ˆå¯¹è¿™ä¸ªtokenstreamè®¾å®šçš„ä¸åŒå€¼ï¼Œåªä¼šåœ¨æœ€åä¸€ä¸ªè°ƒç”¨çš„å±æ€§ä¼šæˆåŠŸã€‚ï¼ˆæ˜¾ç„¶è¿™å’Œæˆ‘ä»¬çš„æœŸæœ›ç›¸è¿èƒŒï¼‰<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> TokenStream <span class="title">tokenStream</span><span class="params">(Analyzer analyzer, TokenStream reuse)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">this</span>.fieldType().indexOptions() == IndexOptions.NONE) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(!<span class="keyword">this</span>.fieldType().tokenized()) &#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="keyword">this</span>.stringValue() != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span>(!(reuse <span class="keyword">instanceof</span> Field.StringTokenStream)) &#123;</span><br><span class="line">                    reuse = <span class="keyword">new</span> Field.StringTokenStream();</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                ((Field.StringTokenStream)reuse).setValue(<span class="keyword">this</span>.stringValue());</span><br><span class="line">                <span class="keyword">return</span> (TokenStream)reuse;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="keyword">this</span>.binaryValue() != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span>(!(reuse <span class="keyword">instanceof</span> Field.BinaryTokenStream)) &#123;</span><br><span class="line">                    reuse = <span class="keyword">new</span> Field.BinaryTokenStream();</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                ((Field.BinaryTokenStream)reuse).setValue(<span class="keyword">this</span>.binaryValue());</span><br><span class="line">                <span class="keyword">return</span> (TokenStream)reuse;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"Non-Tokenized Fields must have a String value"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="keyword">this</span>.tokenStream != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>.tokenStream;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="keyword">this</span>.readerValue() != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> analyzer.tokenStream(<span class="keyword">this</span>.name(), <span class="keyword">this</span>.readerValue());</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="keyword">this</span>.stringValue() != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> analyzer.tokenStream(<span class="keyword">this</span>.name(), <span class="keyword">this</span>.stringValue());</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"Field must have either TokenStream, String, Reader or Number value; got "</span> + <span class="keyword">this</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p><p>ä½†æ˜¯å³ä½¿è¿™æ ·ï¼Œä¹Ÿä¸åº”è¯¥ä¼šæŠ¥é”™ï¼ŒåŸæ¥å¦‚æœåœ¨create fieldå­—æ®µä¸­è°ƒç”¨<strong>tokenstream</strong>æ–¹æ³•ï¼Œé‚£ä¹ˆé’ˆå¯¹å¤šå€¼å­—æ®µï¼Œé‚£ä¹ˆåŒä¸€ä¸ª<strong>tokenstream</strong>å¯¹è±¡å°±æœ‰å¯èƒ½å¯èƒ½å…±äº«ï¼Œé‚£ä¹ˆå½“Solrå¤„ç†å®Œç¬¬ä¸€ä¸ªå€¼ç»“æŸçš„æ—¶å€™ä¼šå°†tokenstreamè¿›è¡Œé‡åˆ¶ï¼Œé‚£ä¹ˆåŸæœ‰çš„readerå°±ä¼šå¤±æ•ˆï¼Œé‚£ä¹ˆå½“Solrå¼€å§‹å¤„ç†ç¬¬äºŒä¸ªå€¼çš„æ—¶å€™ç”±äºå…±äº«çš„åŒä¸€ä¸ªtokenstream,é‚£ä¹ˆå¯¹ç”¨çš„readerå·²ç»å¤±æ•ˆï¼Œå°±ä¼šæŠ›å‡ºé”™è¯¯ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦æ¯æ¬¡ç”Ÿæˆä¸åŒçš„tokenstreamå°±å¯ä»¥è§£å†³é—®é¢˜<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (val.startsWith(<span class="string">"[|"</span>) &amp;&amp; val.contains(<span class="string">"|]"</span>)) &#123;</span><br><span class="line">            target = val.substring(<span class="number">2</span>,val.indexOf(<span class="string">"|]"</span>));</span><br><span class="line">            <span class="keyword">if</span> (DynamicPayloadAttribute.FIELD_MAPPINGS.containsKey(target)) &#123;</span><br><span class="line">                String parsedData = val.substring(val.indexOf(<span class="string">"|]"</span>)+<span class="number">2</span>);</span><br><span class="line">                TokenizerChain tokenizerChain = (TokenizerChain)field.getType().getIndexAnalyzer();</span><br><span class="line">                Tokenizer tk = tokenizerChain.getTokenizerFactory().create(TokenStream.DEFAULT_TOKEN_ATTRIBUTE_FACTORY);</span><br><span class="line">                TokenStream ts = tk;</span><br><span class="line">                <span class="keyword">for</span> (TokenFilterFactory filter : tokenizerChain.getTokenFilterFactories()) &#123;</span><br><span class="line">                    ts = filter.create(ts);</span><br><span class="line">                &#125;</span><br><span class="line">                Analyzer.TokenStreamComponents components = <span class="keyword">new</span> Analyzer.TokenStreamComponents(tk, ts);</span><br><span class="line">                Reader stringReader = tokenizerChain.initReader(field.getName(),<span class="keyword">new</span> StringReader(parsedData));</span><br><span class="line">                tk.setReader(stringReader);</span><br><span class="line">                TokenStream stream = components.getTokenStream();</span><br><span class="line">                stream.getAttribute(DynamicPayloadAttribute.class).setPayloadType(target);</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> Field(field.getName(), stream, field);</span><br></pre></td></tr></table></figure></p><h2 id="å‚è€ƒçš„é¡¹ç›®æˆ–è€…æ–‡ç« "><a href="#å‚è€ƒçš„é¡¹ç›®æˆ–è€…æ–‡ç« " class="headerlink" title="å‚è€ƒçš„é¡¹ç›®æˆ–è€…æ–‡ç« "></a><font color="#2C3E50">å‚è€ƒçš„é¡¹ç›®æˆ–è€…æ–‡ç« </font></h2><p><a href="https://lucidworks.com/post/solr-payloads/" target="_blank" rel="noopener">SolrPayload åŠŸèƒ½ Example</a><br><a href="https://lucene.apache.org/solr/guide/7_4/filter-descriptions.html#numeric-payload-token-filter" target="_blank" rel="noopener">Solr Numeric Payload Token Filter</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;å¦‚ä½•åŠ¨æ€è®¾ç½®Solr-Payload&quot;&gt;&lt;a href=&quot;#å¦‚ä½•åŠ¨æ€è®¾ç½®Solr-Payload&quot; class=&quot;headerlink&quot; title=&quot;å¦‚ä½•åŠ¨æ€è®¾ç½®Solr Payload &quot;&gt;&lt;/a&gt;&lt;font color=&quot;#0077bb&quot;&gt;å¦‚ä½•åŠ¨æ€è®¾ç½®Solr Payload &lt;/font&gt;&lt;/h1&gt;&lt;h2 id=&quot;é—®é¢˜èƒŒæ™¯&quot;&gt;&lt;a href=&quot;#é—®é¢˜èƒŒæ™¯&quot; class=&quot;headerlink&quot; title=&quot;é—®é¢˜èƒŒæ™¯&quot;&gt;&lt;/a&gt;&lt;font color=&quot;#2C3E50&quot;&gt;é—®é¢˜èƒŒæ™¯&lt;/font&gt;&lt;/h2&gt;&lt;p&gt;Solr ä»6.xå¼€å§‹æä¾›äº†index payloadçš„åŠŸèƒ½ï¼Œï¼ˆpayloadæ˜¯æŒ‡å¯ä»¥æŒ‡å®šä¸ºåˆ†è¯ä¹‹åçš„æ¯ä¸ªtermæŒ‡å®šä¸€ä¸ªäºŒè¿›åˆ¶çš„ä¿¡æ¯ï¼Œç”¨äºé’ˆå¯¹æ¯ä¸ªtermä½œå‡ºä¸€å®šçš„è¡Œä¸ºï¼Œä¾‹å¦‚å¯ä»¥ç”¨æ¥å­˜å‚¨æŒ‡å®šçš„scoreç”¨äºæ’åºï¼Œä¹Ÿå¯ä»¥ç”¨æ¥å­˜å‚¨æŒ‡å®šçš„æ•°æ®ï¼Œç”¨äºæ£€æŸ¥termçš„ä¸€å®šçš„æ£€æŸ¥ï¼‰ï¼Œç®€å•çš„æŸ¥é˜…å®˜æ–¹æ–‡æ¡£ä¹‹åï¼ˆè¿™é‡Œä½¿ç”¨solr7.7.2ä½œä¸ºæ ·ä¾‹ï¼‰,å¾—çŸ¥æˆ‘ä»¬å¯ä»¥åŠ¨æ€çš„è®¾å®šæ¯ä¸ªtermçš„payloadï¼ˆå‚è€ƒ&lt;a href=&quot;https://lucidworks.com/post/end-to-end-payload-example-in-solr/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;SolrPayload&lt;/a&gt;ï¼‰ï¼Œä¹Ÿå¯ä»¥æ ¹æ®æŒ‡å®šçš„token typeè®¾ç½®payloadæ•°å€¼(å‚è€ƒ&lt;a href=&quot;https://lucene.apache.org/solr/guide/7_4/filter-descriptions.html#numeric-payload-token-filter&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Numeric Payload Token Filter&lt;/a&gt;)ï¼Œä½†æ˜¯ä¸Šè¿°ä¸¤ç§æ–¹å¼éƒ½æ— æ³•æ ¹æ®è¾“å…¥çš„å˜åŒ–è€ŒåŠ¨æ€çš„æ”¹å˜payloadçš„å€¼ã€‚&lt;br&gt;
    
    </summary>
    
    
      <category term="Solr" scheme="https://www.fengqinglei.top/tags/Solr/"/>
    
      <category term="Payload" scheme="https://www.fengqinglei.top/tags/Payload/"/>
    
      <category term="åŠ¨æ€è®¾ç½®" scheme="https://www.fengqinglei.top/tags/%E5%8A%A8%E6%80%81%E8%AE%BE%E7%BD%AE/"/>
    
      <category term="Dynamic" scheme="https://www.fengqinglei.top/tags/Dynamic/"/>
    
      <category term="Lucene" scheme="https://www.fengqinglei.top/tags/Lucene/"/>
    
  </entry>
  
</feed>
